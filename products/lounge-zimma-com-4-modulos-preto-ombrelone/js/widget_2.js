var P=Object.defineProperty,A=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable;var I=(r,t,e)=>t in r?P(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,O=(r,t)=>{for(var e in t||(t={}))R.call(t,e)&&I(r,e,t[e]);if(y)for(var e of y(t))m.call(t,e)&&I(r,e,t[e]);return r},w=(r,t)=>A(r,D(t));var T=(r,t,e)=>I(r,typeof t!="symbol"?t+"":t,e);var l=(r,t,e)=>new Promise((s,a)=>{var c=i=>{try{n(e.next(i))}catch(d){a(d)}},p=i=>{try{n(e.throw(i))}catch(d){a(d)}},n=i=>i.done?s(i.value):Promise.resolve(i.value).then(c,p);n((e=e.apply(r,t)).next())});import{i as f,g as v,a as U,l as L,_ as h,b}from"./1eab02655/preload-helper.HSQL4REb.js";import{s as G,g}from"./1eab02655/script.utils.D2w9PLfq.js";const E={SUBSCRIBE:"TOLSTOY_WIDGET_V2_SUBSCRIBE",MESSAGE:"TOLSTOY_WIDGET_V2_MESSAGE"},u={ADD_TO_CART:"tolstoy_add_to_cart",SPOTLIGHT_QUICK_SHOP:"tolstoy_spotlight_carousel_quick_shop_click",PRODUCT_CARD_CLICK:"tolstoy_product_card_click"},_=class _{constructor(){T(this,"subscribers");T(this,"eventsStatus");T(this,"handleMessage",t=>{const{detail:e}=t;if(e!=null&&e.eventName)switch(e.eventName){case u.ADD_TO_CART:case u.SPOTLIGHT_QUICK_SHOP:case u.PRODUCT_CARD_CLICK:this.subscribe(e.eventName,e.callback);break;default:this.notifySubscribers(e.eventName,e)}});this.subscribers=new Map,this.eventsStatus={[u.ADD_TO_CART]:!1,[u.SPOTLIGHT_QUICK_SHOP]:!1,[u.PRODUCT_CARD_CLICK]:!1}}static getInstance(){return _.instance||(_.instance=new _),_.instance}formatMessage(t){return w(O({},t),{transmissionId:t.transmissionId||"widget-v2",timestamp:Date.now()})}updateEventStatus(t,e){t in this.eventsStatus&&(this.eventsStatus[t]=e)}isEventSubscribed(t){return this.eventsStatus[t]||!1}notifySubscribers(t,e){const s=this.subscribers.get(t);s==null||s.forEach(a=>{try{a(e)}catch(c){console.error(`Error in ${t} callback:`,c)}})}subscribe(t,e){var s;this.subscribers.has(t)||this.subscribers.set(t,new Set),(s=this.subscribers.get(t))==null||s.add(e),this.updateEventStatus(t,!0)}unsubscribe(t,e){const s=this.subscribers.get(t);s==null||s.delete(e),(s==null?void 0:s.size)===0&&this.updateEventStatus(t,!1)}postMessage(t){const e=this.formatMessage(t),s=new CustomEvent(E.MESSAGE,{detail:e});window.dispatchEvent(s)}init(){window.addEventListener(E.SUBSCRIBE,this.handleMessage),window.addEventListener(E.MESSAGE,this.handleMessage);const t=new CustomEvent(E.SUBSCRIBE);window.addEventListener("tolstoyWidgetReady",()=>{window.dispatchEvent(t)},{once:!0})}destroy(){window.removeEventListener(E.SUBSCRIBE,this.handleMessage),window.removeEventListener(E.MESSAGE,this.handleMessage)}};T(_,"instance");let C=_;const M=()=>{C.getInstance().init()},B={PRODUCT_TILE:"tolstoy-product-tile"},Q="./styles/product-tile.css",x="w-full",V="tolstoy-collection-page-tile",z="./styles/collection-page-tile.css",q={display:"flex",width:"100%",height:"100%",position:"relative"},N=(r,t)=>l(void 0,null,function*(){const s=G()&&f()?v():U(),a=new URLSearchParams;a.set("productId",r),a.set("appKey",t);try{return(yield fetch(`${s}/settings/widget/get-product-gallery-config?${a}`)).json()}catch(c){return L(c,"Error getting collection page tile config"),null}}),k=()=>l(void 0,null,function*(){var r,t,e;try{const s=g("product-id"),a=g("app-key");if(!s||!a)return;const c=g("product-gallery-projects");try{const o=JSON.parse(c);if(console.log("productGalleryProjects",o),!o.length)return}catch(o){console.error("Error parsing product gallery projects:",o);return}const p=!!new URLSearchParams(location.search).get("new-render"),n=yield N(s,a);if(!((r=n==null?void 0:n.product)!=null&&r.images)||!((t=n==null?void 0:n.vodAssets)!=null&&t.length)||!((e=n==null?void 0:n.projects)!=null&&e.length))return;const i=n.product.images.map(o=>o.src),d=new URLSearchParams(location.search).get("test-gallery");if(d){const{renderTestGalleryIfNeeded:o}=yield h(()=>l(void 0,null,function*(){const{renderTestGalleryIfNeeded:S}=yield import("./1eab02655/render-test-gallery.BPK5TMQU.js");return{renderTestGalleryIfNeeded:S}}),[]);o(d,i)}if(p){const{initImageDetectionV2:o}=yield h(()=>l(void 0,null,function*(){const{initImageDetectionV2:S}=yield import("./1eab02655/image-detection-new.utils.DJteEoNI.js");return{initImageDetectionV2:S}}),[]);return o(n)}else{const{initImageDetection:o}=yield h(()=>l(void 0,null,function*(){const{initImageDetection:S}=yield import("./1eab02655/image-detection.utils.BSy6WJG3.js");return{initImageDetection:S}}),[]);return o(n)}}catch(s){L(s,"Error initializing product gallery video")}}),H={PRODUCT_TILE:{key:B.PRODUCT_TILE,controller:()=>h(()=>import("./1eab02655/product-tiles-controller.aA8uAaDX.js"),[])},COLLECTION_PAGE_TILE:{key:V,controller:()=>h(()=>import("./1eab02655/collection-page-tile-controller.BbUlvetY.js"),[])}},Y={PRODUCT_GALLERY_VIDEO:{init:k}},K=()=>l(void 0,null,function*(){try{M(),yield b(H,Y)}catch(r){L(r)}});K();export{z as C,C as E,Q as P,x as a,q as b};
