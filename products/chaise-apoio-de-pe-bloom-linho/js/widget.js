var ds=Object.defineProperty,us=Object.defineProperties;var ps=Object.getOwnPropertyDescriptors;var ft=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var Wt=(e,t,o)=>t in e?ds(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,m=(e,t)=>{for(var o in t||(t={}))De.call(t,o)&&Wt(e,o,t[o]);if(ft)for(var o of ft(t))ke.call(t,o)&&Wt(e,o,t[o]);return e},w=(e,t)=>us(e,ps(t));var Be=(e,t)=>{var o={};for(var s in e)De.call(e,s)&&t.indexOf(s)<0&&(o[s]=e[s]);if(e!=null&&ft)for(var s of ft(e))t.indexOf(s)<0&&ke.call(e,s)&&(o[s]=e[s]);return o};var g=(e,t,o)=>(Wt(e,typeof t!="symbol"?t+"":t,o),o);var h=(e,t,o)=>new Promise((s,n)=>{var i=l=>{try{c(o.next(l))}catch(d){n(d)}},r=l=>{try{c(o.throw(l))}catch(d){n(d)}},c=l=>l.done?s(l.value):Promise.resolve(l.value).then(i,r);c((o=o.apply(e,t)).next())});const M={pageView:"pageView",sessionStart:"sessionStart",sessionEnd:"sessionEnd",videoPause:"videoPause",videoStart:"videoStart",videoResume:"videoResume",videoReplay:"videoReplay",clickCta:"clickCta",submitInput:"submitInput",collectInfo:"collectInfo",videoResponse:"videoResponse",audioResponse:"audioResponse",imageResponse:"imageResponse",tolstoyClick:"tolstoyClick",chapterSelected:"chapterSelected",chapterPickerOpened:"chapterPickerOpened",videoSeeked:"videoSeeked",shareClick:"shareClick",quizResult:"quizResult",autoplayStart:"autoplayStart"},E={sessionStart:"tolstoyStarted",sessionEnd:"tolstoyReachedEnd",clickCta:"tolstoyAnswerClicked",submitInput:"tolstoyInputSubmit",collectInfo:"tolstoyLeadFormSubmit",videoResponse:"tolstoyVideoSubmit",audioResponse:"tolstoyAudioSubmit",imageResponse:"tolstoyImageSubmit",openGorgias:"tolstoyOpenGorgias",hideGorgias:"tolstoyHideGorgias",openIntercom:"tolstoyOpenIntercom",hideIntercom:"tolstoyHideIntercom",openTawkTo:"tolstoyOpenTawkTo",hideTawkTo:"tolstoyHideTawkTo",openLiveChat:"tolstoyOpenLiveChat",hideLiveChat:"tolstoyHideLiveChat",openHubSpot:"tolstoyOpenHubSpot",hideHubSpot:"tolstoyHideHubSpot",openHelpScout:"tolstoyOpenHelpScout",hideHelpScout:"tolstoyHideHelpScout",openDrift:"tolstoyOpenDrift",hideDrift:"tolstoyHideDrift",openZendesk:"tolstoyOpenZendesk",hideZendesk:"tolstoyHideZendesk"},Tc="tolstoyEscapeKeyPressed",hs="tolstoyWatchedProductIds",Ic="showFeedProductModal",bc="tolstoyWidgets",Cc="showFeedCartMobile",_c="tolstoyMoveToUrl",vc="tolstoyCloseModalMessage",oo="tolstoyPlayerReady",Ac="focusCloseButton",G={OPEN:"open",CLOSE:"close",PLAY:"play",PAUSE:"pause"},ys=[G.OPEN,G.PLAY],gs=[G.CLOSE,G.PAUSE],Oc={ready:"tolstoyPreConfigMessengerReady",vodAssetIds:"tolstoyVodAssetIds"},Pc="rechargeMessaging",Rc="tolstoyRechargeWidgetData",Mc="tolstoyRequestRechargeWidgetData",Lc="tolstoyRequestRechargeAddToCart",et={static:"static",dynamic:"dynamic",hoverOver:"hoverOver"},Nc={under:"under",over:"over"},ms={carousel:"tolstoy-carousel",carouselContainer:"tolstoy-carousel-container",title:"tolstoy-carousel-title",videoCarouselContainer:"tolstoy-video-carousel-container",previousButton:"tolstoy-previous-button",nextButton:"tolstoy-next-button",arrowsContainer:"tolstoy-carousel-arrows-container",videosContainer:"tolstoy-carousel-videos-container",videoContainer:"tolstoy-carousel-video-container",video:"tolstoy-carousel-video",image:"tolstoy-carousel-image",dotsContainer:"tolstoy-dots-container",dot:"tolstoy-dot",playButtonContainer:"tolstoy-play-button-container",controlsContainer:"tolstoy-carousel-controls-container",expandButton:"tolstoy-carousel-expand-button",muteButton:"tolstoy-carousel-mute-button",playButton:"tolstoy-carousel-play-button",tileContainer:"tolstoy-carousel-tile-container",tile:"tolstoy-carousel-tile",centerTile:"tolstoy-carousel-center-tile",tileNameContainer:"tolstoy-tile-name-container",tileNameText:"tolstoy-carousel-tile-name-text",arrowButtonContainer:"tolstoy-carousel-arrow-button-container",arrowButton:"tolstoy-carousel-arrow-button",tileNameHeightPlaceholder:"tolstoy-tile-name-height-placeholder",productTile:"tolstoy-product-tile",productContent:"tolstoy-product-content",productTileImage:"tolstoy-product-tile-image",productTileTitle:"tolstoy-product-tile-title",tileText:"tolstoy-tile-text",variantTile:"tolstoy-product-variant-tile",variantTileIcon:"tolstoy-product-variant-tile-icon",variantTileTitle:"tolstoy-product-variant-tile-title",productTilePrice:"tolstoy-product-tile-price",productTileSubtitle:"tolstoy-product-tile-subtitle",productTileButton:"tolstoy-product-tile-button",productTileArrow:"tolstoy-product-tile-arrow",productTileFallback:"tolstoy-product-tile-fallback",descriptionTile:"tolstoy-description-tile",descriptionTileContent:"tolstoy-description-tile-content",descriptionTileButton:"tolstoy-description-tile-button"},Uc=6,Dc=2,kc=80,Bc=.3,$c=80,xc=12,Es=416,Hc={DEFAULT:"default",SPOTLIGHT:"spotlight"},Wc={product:"product",videoName:"videoName",none:"none"},Vc={shoppableVideoCarousel:"Shoppable Video Carousel",viewProduct:"View Product"},ws={embed:"tolstoy-embed",iframe:"tolstoy-embed-iframe",videoPreview:"tolstoy-embed-video-preview",videoContainer:"tolstoy-embed-video-container",playButtonContainer:"tolstoy-embed-play-button-container",startText:"tolstoy-embed-start-text",startButtonContainer:"tolstoy-embed-start-button-container",startButton:"tolstoy-embed-start-button",embedContainer:"tolstoy-embed-container"},Fc=9/16,fs={story:"tolstoy-stories",storiesMainContainer:"tolstoy-stories-main-container",storiesContainer:"tolstoy-stories-container",tilesContainer:"tolstoy-stories-tiles-container",tileName:"tolstoy-stories-tile-name",storyTile:"tolstoy-stories-tile",storyImage:"tolstoy-stories-story-image",storyVideo:"tolstoy-stories-story-video",plusTile:"tolstoy-stories-plus-tile",storyName:"tolstoy-stories-story-name",titleContainer:"tolstoy-stories-title",plusTileContainer:"tolstoy-stories-plus-tile-container",previousButton:"tolstoy-stories-previous-button",nextButton:"tolstoy-stories-next-button",onYouButton:"tolstoy-stories-on-you-button",onlyOnYouButton:"tolstoy-stories-only-on-you-button",playButtonContainer:"tolstoy-stories-play-button-container"},Ss=".0000000.jpg",Ts=".avatar",Yc=`${Ts}${Ss}`,Gc={static:et.static,dynamic:et.dynamic},Is={responsive:"responsive",fixed:"fixed"},Kc={below:"below",overlay:"overlay"},jc=Is.fixed,qc=8,zc=80,Zc=8,Xc=256,bs={tile:"tolstoy-tile",tileContainer:"tolstoy-tile-container",video:"tolstoy-tile-video",nativeCaptionsTrack:"tolstoy-tile-native-captions-track",customCaptionsTrack:"tolstoy-tile-custom-captions-track",imageOverlay:"tolstoy-tile-image-overlay",image:"tolstoy-tile-image",controlsOverlay:"tolstoy-tile-controls-overlay",controlsContainer:"tolstoy-tile-controls",playButtonOverlay:"tolstoy-tile-play-button-overlay",playButtonContainer:"tolstoy-tile-play-button-container",playButtonLabelContainer:"tolstoy-tile-play-button-label-container",playButtonLabel:"tolstoy-tile-play-button-label",timebarWrapper:"tolstoy-tile-timebar-wrapper",timebarContainer:"tolstoy-tile-timebar-container",timebar:"tolstoy-tile-timebar",timeIndicator:"tolstoy-tile-time-indicator",muteButton:"tolstoy-tile-mute-button",fullScreenButton:"tolstoy-tile-full-screen-button",togglesContainer:"tolstoy-tile-toggles",captionsButton:"tolstoy-tile-captions-button"},ee={collectionTile:"tolstoy-collection-tile",video:"tolstoy-collection-tile-video",controlsContainer:"tolstoy-collection-tile-controls-container",playButton:"tolstoy-collection-tile-play-button",muteButton:"tolstoy-collection-tile-mute-button"},Qc={AUTOPLAY:"autoplay",CLICK:"click"},Jc={CONSECUTIVELY:"consecutively",SIMULTANEOUSLY:"simultaneously"},tl={LOOP:"loop",PLAY_ONCE:"playOnce"},el={PDP:"pdp",PLAY:"play"},ol="data-tolstoy-collection-tile-key",so="tolstoy-collection-page-tile",oe="carousel",Cs="inTileCarousel",no="bubble",se="stories",ne="embed",sl="onYou",ie="tile",io="centeredModal",ut="collectionTile",ro="collectionPageTile",nl={clickedX:"stopShowingWidgetToClickedX",viewed:"stopShowingWidgetToViewed"},ao={[oe]:ms.carousel,[se]:fs.story,[ne]:ws.embed,[ie]:bs.tile,[ut]:ee.collectionTile,[ro]:so},_s="siteActivity",vs="pageVisit",il={notAllowedError:"NotAllowedError",abortError:"AbortError"},As=1,ht={shop:"shop",appKey:"app-key",productId:"product-id",shouldUseCache:"should-use-cache",cacheVersion:"cache-version"},he={tolstoyAutoOpen:"tolstoyAutoOpen",tolstoyAutoOpenOnYou:"tolstoyAutoOpenOnYou",tolstoyStartVideo:"tolstoyStartVideo",tolstoyMoneyFormat:"tolstoyMoneyFormat"},Os="PRODUCT_ID",rl={TOP:"top",BOTTOM:"bottom"},f={embedView:"embedView",embedPlay:"embedPlay",embedPause:"embedPause",embedMute:"embedMute",embedUnmute:"embedUnmute",embedExpand:"embedExpand",tolstoyModalClose:"tolstoyModalClose",feedProductModalOpen:"feedProductModalOpen",feedProductModalClose:"feedProductModalClose",videoLoaded:"videoLoaded",pageView:"pageView",clickViewProduct:"clickViewProduct",openProductPageClick:"openProductPageClick",feedPlay:"feedPlay",feedPause:"feedPause",videoMuted:"videoMuted",videoUnmuted:"videoUnmuted",videoWatched:"videoWatched",openShareLink:"Open Share Link",feedNavigationArrowClick:"feedNavigationArrowClick",feedScroll:"feedScroll",sessionStart:"sessionStart",tolstoyStarted:"tolstoyStarted",abTestInitialized:"abTestInitialized",onYouClick:"onYouClick"},co="https://api.gotolstoy.com",ye="https://apilb.gotolstoy.com",lo="https://cf-apilb.gotolstoy.com",Ps="https://player.gotolstoy.com",Rs="https://on-you.gotolstoy.com",al="https://play.gotolstoy.com/hero",re="widget.gotolstoy.com",uo="https://videos.gotolstoy.com",Ms="https://api.gotolstoy.com/migrations/recreate-video",Ls="https://analytics-v2.gotolstoy.com/site-activity",Ns="https://analytics-v2.gotolstoy.com/page-visit",Us=e=>{var t;return e!=null&&e.length?`${(t=e[0])==null?void 0:t.toUpperCase()}${e==null?void 0:e.slice(1)}`:""},N=e=>{var o;if(!("URLSearchParams"in window))return null;try{return new URLSearchParams((o=window.location)==null?void 0:o.search).get(e)}catch(s){if(s)return null}},cl=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,po=()=>{const e=t=>{const o=Math.floor(Math.random()*16);return(t==="x"?o:o&3|8).toString(16)};return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e)},ho=()=>N("td")==="true",Ds=e=>{ho()&&console.log(e)},yo=e=>{ho()&&console.error(e)},ks=()=>["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,ll=()=>ks()||window.screen.width<=450||window.screen.height<=450,dl=(e,t=300)=>{let o;return(...s)=>{clearTimeout(o),o=setTimeout(()=>{e(...s)},t)}},ul=(e=0)=>h(void 0,null,function*(){return new Promise(t=>{setTimeout(t,e)})}),pl=(e,t=1)=>{const o=Number(e);return Number.isNaN(o)?0:Number.isInteger(o)?o:Number.parseFloat(o.toFixed(t))},hl=e=>e.replace(/<[^>]*>?/gm,""),Bs=e=>e==null,yl=e=>{const t=Math.floor(e/60),o=Math.floor(e%60);return`${t}:${o.toString().padStart(2,"0")}`},O=()=>{var e,t;return((t=(e=window.Shopify)==null?void 0:e.customerPrivacy)==null?void 0:t.currentVisitorConsent().analytics)!=="no"},$s=e=>{const t=/^[\da-f]{8}-[\da-f]{4}-[0-5][\da-f]{3}-[089ab][\da-f]{3}-[\da-f]{12}$/i;return e==null?void 0:e.match(t)},go=e=>ys.includes(e),xs=e=>gs.includes(e),Hs=(e,t)=>{const o=e.src;return new URL(o).searchParams.get(t)},Ws=(e,t)=>e.getAttribute(`data-${t}`),K=e=>{const t=document.querySelectorAll(`script[src*="${re}"]`);for(const o of t){const s=Ws(o,e)||Hs(o,e);if(s)return s}},Vs=e=>{var o;const t=(o=e==null?void 0:e.dataset)==null?void 0:o.productId;return t==="{{ product.id }}"?null:t},Lt=()=>{const e=K(ht.productId);if(e)return e;const{stories:t,carousel:o,embed:s,tile:n}=ao,i=document.querySelectorAll(`.${t}, .${o}, .${s}, .${n}`);for(const r of i){const c=Vs(r);if(c)return c}},mo=()=>K(ht.shouldUseCache)==="true",W=()=>K(ht.cacheVersion),Fs="www.",Eo=new RegExp("^((([A-Za-z]{3,9}:(?:\\/\\/)?)(?:[\\-;:&=\\+\\$,\\w]+@)?[A-Za-z0-9\\.\\-]+|(?:www\\.|[\\-;:&=\\+\\$,\\w]+@)[A-Za-z0-9\\.\\-]+)((?:\\/[\\+~%\\/\\.\\w\\-_]*)?\\??(?:[\\-\\+=&;%@\\.\\w_]*)#?(?:[\\.\\!\\/\\\\\\w]*))?)","i"),$e=e=>e?!!Eo.test(e)||e.startsWith("tel:")||e.startsWith("mailto:")||e.startsWith("_self:"):!1,xe=e=>{const t=e.replace(Fs,""),o=new URL(t);return`${o.origin}${o.pathname}${o.search}`},gl=(e,t)=>!$e(e)||!$e(t)?!1:xe(e)===xe(t),Ys=()=>{const e=new URLSearchParams(window.location.search),t=new URLSearchParams;for(const[o,s]of e){const n=o.toLowerCase();o.length<50&&s.length<100&&(n.startsWith("custom_")||n.startsWith("utm_"))&&t.append(o,s)}return t},yt=(e={})=>{const t=new URLSearchParams;for(const[o,s]of Object.entries(e))s!=null&&s!==""&&t.append(o,s);return t.toString()},ml=e=>Eo.test(e),El=e=>new URLSearchParams(window.location.search).get("tolstoy")===e;function Nt(){return K(ht.shop)}let St="";function v(){return window.tolstoyAppKey||St?window.tolstoyAppKey||St:(St=K(ht.appKey),St)}const Gs=4e3;let wo=!1;const ae=[],Ks=()=>{for(;ae.length>0;){const{eventFunction:e,args:t}=ae.shift();e(...t)}};setTimeout(()=>{wo=!0,Ks()},Gs);const ge=e=>(...t)=>{if(wo)return e(...t);ae.push({eventFunction:e,args:t})},gt=()=>{var e,t;return(e=window.tolstoySettings)!=null&&e.shouldUseCache||(t=window.tolstoySettings)!=null&&t.cacheVersion?lo:ye},js=()=>h(void 0,null,function*(){var i,r;const e=v(),t=((i=window.Shopify)==null?void 0:i.shop)||Nt(),o=mo(),s=W(),n=o||s?lo:ye;try{const c=new URL(`${n}/actions/accounts/${e}`);return s&&c.searchParams.set("v",s),t&&c.searchParams.set("appUrl",t),(yield fetch(c.toString())).json()}catch(c){(r=window.tolstoyCaptureError)==null||r.call(window,c,"Error loading account settings:")}}),qs=e=>h(void 0,null,function*(){var t;try{return O()?(yield fetch(`${co}/identify/identify`,{method:"POST",body:JSON.stringify({data:e})})).json():void 0}catch(o){(t=window.tolstoyCaptureError)==null||t.call(window,o,"Error updating identification:")}}),wl=(e,t)=>h(void 0,null,function*(){var r;const o=Lt(),s=gt(),n=W(),i=yt({widgetType:t,productId:o,publishId:e,v:n});try{return(yield fetch(`${s}/settings/widget/by-publish-id?${i}`)).json()}catch(c){(r=window.tolstoyCaptureError)==null||r.call(window,c,"Error loading config:")}}),zs=e=>h(void 0,null,function*(){var n;const t=gt(),o=W(),s=yt(w(m({},e),{url:`${window.location.origin}${window.location.pathname}`,v:o}));try{return(yield fetch(`${t}/settings/widget/by-product-url?${s}`)).json()}catch(i){(n=window.tolstoyCaptureError)==null||n.call(window,i,"Error getting product page config:")}}),Zs=e=>h(void 0,null,function*(){var n;const t=gt(),o=W(),s=yt(w(m({},e),{v:o}));try{return(yield fetch(`${t}/settings/widget/by-product-id?${s}`)).json()}catch(i){(n=window.tolstoyCaptureError)==null||n.call(window,i,"Error getting product page config:")}}),Xs=(e,t)=>h(void 0,null,function*(){var i;const o=gt(),s=W(),n=yt({appKey:e,collectionId:t,v:s});try{return(yield fetch(`${o}/settings/widget/get-collection-tile-config?${n}`)).json()}catch(r){(i=window.tolstoyCaptureError)==null||i.call(window,r,"Error getting collection tile config:")}}),Qs=e=>h(void 0,null,function*(){var o;const t=new URLSearchParams(e);try{return(yield fetch(`${ye}/settings/bubble?${t.toString()}`)).json()}catch(s){(o=window.tolstoyCaptureError)==null||o.call(window,s,"Error getting bubble settings:")}}),fl=(e,t)=>h(void 0,null,function*(){var i;const o=gt(),s=W(),n=yt({publishId:e,collectionId:t,v:s});try{return(yield fetch(`${o}/settings/collection-page-tile-config?${n}`)).json()}catch(r){(i=window.tolstoyCaptureError)==null||i.call(window,r,"Error getting collection page tile config:")}}),fo=e=>h(void 0,null,function*(){var t;if(window.location.origin!=={}.VITE_BASE_URL&&O())try{return yield fetch(`${co}/events/event`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})}catch(o){(t=window.tolstoyCaptureError)==null||t.call(window,o,"Error sending page view:")}}),ce=ge(fo),Sl=e=>h(void 0,null,function*(){var t;try{return yield fetch(`${Ms}?publishId=${e}`)}catch(o){(t=window.tolstoyCaptureError)==null||t.call(window,o)}}),Js=ge(e=>{var t;if(O())try{window.navigator.sendBeacon(Ls,JSON.stringify(e))}catch(o){const s="Error occurred in createSiteActivityEvent";console.error(s,o),(t=window.tolstoyCaptureError)==null||t.call(window,o,s)}}),tn=ge(e=>{var t;if(O())try{window.navigator.sendBeacon(Ns,JSON.stringify(e))}catch(o){const s="Error occurred in createPageVisitEvent";console.error(s,o),(t=window.tolstoyCaptureError)==null||t.call(window,o,s)}}),en="custom-blocks.tapcart.com",mt=()=>{var e,t,o;return!!((e=window==null?void 0:window.Tapcart)!=null&&e.isInitialized||(o=(t=document.location)==null?void 0:t.host)!=null&&o.includes(en))},So=()=>{var t,o,s;const e=(s=(o=(t=window==null?void 0:window.Tapcart)==null?void 0:t.variables)==null?void 0:o.device)==null?void 0:s.id;return e==null?void 0:e.toLowerCase()},me={TOLSTOY_HIDE_WIDGET_STORAGE_KEY:"tolstoy-hide-widget",TOLSTOY_SESSION_ID_KEY:"tolstoy-session-id",TOLSTOY_SESSION_UNIQUE_ID_KEY:"tolstoy-session-unique-id",TOLSTOY_PRODUCT_RECOMMENDATIONS:"tolstoy-product-recommendation",TOLSTOY_ANONYMOUS_ID:"tolstoy-anonymousId",TOLSTOY_REPLY:"tolstoy-reply",TOLSTOY_GROUP:"tolstoy-group",TOLSTOY_PUBLISH_ID:"tolstoy-publishId",TOLSTOY_ACTIVITY_KEY:"tolstoy-activity",TOLSTOY_NOT_VISIBLE_OPENED_PUBLISH_ID_KEY:"tolstoy-not-visible-opened-publish-id",TOLSTOY_INTERACTION_DATE:"tolstoy-interaction-date",IS_SHOPIFY_CART_ANONYMOUS_ID_SET_KEY:"tolstoy-is-shopify-cart-anonymous-id-set",TOLSTOY_COOKIE_POLICY:"tolstoy-cookie-policy",TOLSTOY_RECREATE_RESOLUTIONS_PREFIX:"tolstoy-recreate-resolutions",TOLSTOY_AB_TEST_GROUP:"tolstoy-ab-test-group"},Ut={accepted:"accepted",rejected:"rejected"},I={IDENTIFY_INFO_ID_KEY:"identifyInfoId",SESSION_COUNTER_KEY:"tolstoySessionCounter",LAST_SEEN_AT_KEY:"tolstoyLastSeenAtKey",FIRST_SEEN_AT_KEY:"tolstoyFirstSeenAtKey",TOLSTOY_VIEWERS_KEY:"tolstoyViewers",TOLSTOY_VIEWED_PRODUCTS:"tolstoyViewedProducts",CURRENT_CUSTOMER_EMAIL_KEY:"tolstoyCurrentCustomer",BUBBLE_TEXT_PREFIX:"bubbleText",NOTIFICATION_BADGE_PREFIX:"notificationBadge",RECREATE_NEW_RESOLUTION_PREFIX:"reCreateNewResolution"},{TOLSTOY_COOKIE_POLICY:To}=me;function Ot(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.trunc(Math.random()*16);return(e==="x"?t:t&3|8).toString(16)})}function j(e){var t;try{return e()}catch(o){return(t=window.tolstoyCaptureError)==null||t.call(window,o),null}}function U(e){return j(()=>window.sessionStorage.getItem(e))}function P(e){return j(()=>localStorage.getItem(e))||U(e)}function pt(e){return P(e)||U(e)}function D(e,t,o=!1){j(()=>{if(!(Ee()===Ut.rejected&&!o))return window.sessionStorage.setItem(e,t)})}function k(e,t,o=!1){j(()=>{if(Ee()!==Ut.rejected)return localStorage.setItem(e,t);if(o)return window.sessionStorage.setItem(e,t)})}function V(e,t,o=!1){j(()=>{if(Ee()!==Ut.rejected)return localStorage.setItem(e,t);if(o)return window.sessionStorage.setItem(e,t)})}function on(e){return j(()=>window.sessionStorage.removeItem(e))}const Ee=()=>pt(To),sn=e=>{V(To,e,!0)},Io=e=>{const t=window.location.host;document.cookie=`${e}=; path=/; domain=.${t}; expires=Thu, 01 Jan 1970 00:00:00 UTC;`,document.cookie=`${e}=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;`},vt=e=>[...Object.values(me),...Object.values(I)].some(o=>e.includes(o));function nn(){const e=document.cookie.split("; ");for(const t of e){const[o]=t.split("=");vt(o.trim())&&Io(o)}for(const t in localStorage)vt(t)&&localStorage.removeItem(t);for(const t in sessionStorage)vt(t)&&sessionStorage.removeItem(t)}const rn=()=>{const e=document.cookie.split("; ");for(const t of e){const[o]=t.split("=");vt(o.trim())&&Io(o)}};rn();const{TOLSTOY_HIDE_WIDGET_STORAGE_KEY:we,TOLSTOY_SESSION_ID_KEY:fe,TOLSTOY_SESSION_UNIQUE_ID_KEY:bo,TOLSTOY_PRODUCT_RECOMMENDATIONS:an,TOLSTOY_ANONYMOUS_ID:Co,TOLSTOY_REPLY:cn,TOLSTOY_GROUP:Tl,TOLSTOY_PUBLISH_ID:ln,TOLSTOY_ACTIVITY_KEY:Dt,TOLSTOY_NOT_VISIBLE_OPENED_PUBLISH_ID_KEY:_o,TOLSTOY_INTERACTION_DATE:He,IS_SHOPIFY_CART_ANONYMOUS_ID_SET_KEY:vo,TOLSTOY_RECREATE_RESOLUTIONS_PREFIX:Il,TOLSTOY_AB_TEST_GROUP:Ao}=me;function le(e){return e?`${He}-${e}`:He}function dn(){return pt(Co)}function un(e){!e||["undefined","false"].includes(e)||V(Co,e)}function kt(){let t=(mt()?So():null)||dn()||Ot();return t==="false"&&(t=Ot()),un(t),t}function pn(e){V(ln,e,!0)}function Pt(){return JSON.parse(U(Dt)||"{}")}function Oo({publishId:e,timeStamp:t,type:o,sessionId:s}){const n=Pt()||{},i=n[e]||[];n[e]=[...i,{timeStamp:t,type:o,sessionId:s}],D(Dt,JSON.stringify(n),!0)}const hn=({publishId:e,productId:t})=>{const o=gn(),s=o[t]||[],n={interactionDate:new Date().toISOString(),publishId:e,productId:t};s.push(n),o[t]=s,mn(o)},yn=()=>{D(Dt,"{}",!0)};function bl(e){V(cn,e)}function Cl(){V(an,!0)}const Vt=()=>JSON.parse(P(I.TOLSTOY_VIEWERS_KEY)||"{}"),gn=()=>JSON.parse(pt(I.TOLSTOY_VIEWED_PRODUCTS)||"{}"),mn=e=>{V(I.TOLSTOY_VIEWED_PRODUCTS,JSON.stringify(e))},Ft=e=>{k(I.TOLSTOY_VIEWERS_KEY,JSON.stringify(e))};function En(e){return pt(le(e))||pt(le())}function wn(e){k(I.IDENTIFY_INFO_ID_KEY,e)}function fn(){return P(I.IDENTIFY_INFO_ID_KEY)}function Sn(){localStorage.removeItem(I.IDENTIFY_INFO_ID_KEY)}const Tn=e=>{k(I.SESSION_COUNTER_KEY,e)},Po=()=>Number(P(I.SESSION_COUNTER_KEY)),In=e=>{k(I.FIRST_SEEN_AT_KEY,e)},Ro=()=>P(I.FIRST_SEEN_AT_KEY);function bn(e){const t=new Date().toISOString();V(le(e),t)}const Mo=e=>U(`${we}-${e}`),_l=e=>D(`${we}-${e}`,"true",!0),vl=e=>window.sessionStorage.removeItem(`${we}-${e}`),Bt=()=>U(fe),Lo=e=>D(fe,e,!0),Al=()=>on(fe),Se=()=>{const e=U(bo);return e||Cn()},Cn=()=>{const e=Ot();return D(bo,e,!0),e},_n=()=>{const e=U(_o);return!e||e==="null"?null:e},Te=e=>D(_o,e,!0),vn=(e,t)=>{const o=Pt()||{},s=o[e]||[];if(!(s!=null&&s.length))return;const n=s[s.length-1];n.sessionId=t,D(Dt,JSON.stringify(o),!0)},An=()=>U(vo),On=e=>D(vo,e),Ol=(e,t)=>k(`${I.NOTIFICATION_BADGE_PREFIX}-${e}`,t,!0),Pl=e=>P(`${I.NOTIFICATION_BADGE_PREFIX}-${e}`),Rl=(e,t,o)=>k(`${I.BUBBLE_TEXT_PREFIX}-${e}-${t}`,o,!0),Ml=(e,t)=>P(`${I.BUBBLE_TEXT_PREFIX}-${e}-${t}`),Ll=(e,t)=>k(`${I.RECREATE_NEW_RESOLUTION_PREFIX}-${e}`,t,!0),Nl=e=>P(`${I.RECREATE_NEW_RESOLUTION_PREFIX}-${e}`),Pn=(e,t)=>k(`${Ao}-${e}`,t,!0),Rn=e=>P(`${Ao}-${e}`),Mn=1e3*60*60*24,Q=e=>`tolstoy${Us(e)}`,Yt=e=>{O()&&(Nn(e),Ln(e))},Ln=e=>{const{data:{name:t,text:o,facebookAnalyticsID:s,playlist:n,collectInfoType:i}}=e;if(!window.fbq||!s||!n)return;const r=`tolstoy-${n}`;switch(t){case E.sessionStart:R(s,`${r}-click`,{value:"Start Tolstoy"});break;case E.clickCta:R(s,`${r}-click`,{value:o});break;case E.submitInput:R(s,`${r}-input`,{value:o});break;case E.collectInfo:R(s,`${r}-${M.collectInfo}`,{value:i});break;case E.videoResponse:R(s,`${r}-${M.videoResponse}`);break;case E.imageResponse:R(s,`${r}-${M.imageResponse}`);break;case E.audioResponse:R(s,`${r}-${M.audioResponse}`);break;case M.sessionEnd:R(s,`${r}-${M.sessionEnd}`);break}},R=(e,t,o)=>{window.fbq("trackSingleCustom",e,t,o)},Nn=e=>{const{data:{name:t,text:o,googleAnalyticsID:s,playlist:n,collectInfoType:i,productNames:r,totalTime:c,videoName:l,type:d,direction:y}}=e;if(!window.gtag&&!window.dataLayer&&!window.ga||!s||!n)return;const p=`tolstoy-${n}`;switch(t){case f.pageView:break;case M.sessionStart:case E.sessionStart:C(s,p,E.sessionStart),C(s,p,"click","Start Tolstoy");break;case E.clickCta:C(s,p,t,o);break;case E.collectInfo:C(s,p,t,i);break;case E.submitInput:case E.imageResponse:case E.audioResponse:case E.videoResponse:case E.sessionEnd:C(s,p,t);break;case f.tolstoyModalClose:C(s,p,f.tolstoyModalClose,c);break;case f.videoLoaded:r&&C(s,p,"tolstoyVideoLoaded-products",r),C(s,p,"tolstoyVideoLoaded-videoName",l);break;case f.feedProductModalOpen:case f.feedProductModalClose:case f.clickViewProduct:case f.openProductPageClick:C(s,p,Q(t),r);break;case f.feedPlay:case f.feedPause:case f.videoMuted:case f.videoUnmuted:case f.videoWatched:C(s,p,Q(t),l);break;case f.openShareLink:C(s,p,Q("openShareLink"),d);break;case f.feedNavigationArrowClick:case f.feedScroll:C(s,p,Q(t),y);break;default:C(s,p,Q(t),o)}},C=(e,t,o,s)=>{O()&&(window.gtag?window.gtag("event",o,{event_category:t,event_label:s,send_to:e}):window.dataLayer&&window.dataLayer.push({event:o,event_category:t,event_label:s,send_to:e}))},de={},Gt=(e,t)=>{de[e]=de[e]||t};let We=!1;const Un=()=>{var e;if(!We)try{const t=v();Dn({appKey:t}),We=!0}catch(t){console.error(t),(e=window.tolstoyCaptureError)==null||e.call(window,t)}},Dn=({appKey:e}={})=>{let t=0,o=!1;if(Te(null),!$s(e))return;const s=({now:n,performanceNow:i})=>{var S;o=!1;let r=Pt();Hn(n,r),r=Pt();const c=Math.round(i-t),l=Se(),d=kn(r),y=window.location.href.split("?")[0],p=Lt(),b={appKey:e,sessionUniqueId:l,timestamp:new Date().toISOString(),anonymousId:kt(),storeUrl:(S=window.Shopify)==null?void 0:S.shop,siteActivity:d,eventName:_s,timeOnPage:c,pageUrl:y,currentPageProductId:p};Js(b),o=!0,yn()};document.addEventListener("visibilitychange",()=>{var n;try{const i=Date.now(),r=window.performance.now();document.visibilityState==="visible"&&(t=r,o=!1,xn(i)),document.visibilityState==="hidden"&&!o&&s({now:i,performanceNow:r})}catch(i){console.error(i),(n=window.tolstoyCaptureError)==null||n.call(window,i)}}),window.addEventListener("beforeunload",()=>{var n;if(!o)try{const i=Date.now(),r=window.performance.now();s({now:i,performanceNow:r})}catch(i){console.error(i),(n=window.tolstoyCaptureError)==null||n.call(window,i)}})},kn=e=>{const t={};for(const[o,s]of Object.entries(de)){const n=e[o];!(n!=null&&n.length)&&!t[o]&&(t[o]={activity:{},totalTime:0,impression:s});const i=Bn({publishId:o,activities:n});let r=0;for(const c of Object.values(i))r+=c;t[o]={activity:i,totalTime:r,impression:s}}return t},Bn=({publishId:e,activities:t})=>{if(!e||!(t!=null&&t.length))return{};const o=Date.now(),s={},n={};for(const{timeStamp:i,type:r,sessionId:c}of t)n[c]=n[c]||0,s[c]===void 0&&(s[c]=!1),go(r)&&!s[c]&&(s[c]=!0,n[c]-=i),xs(r)&&s[c]&&(s[c]=!1,n[c]+=i);for(const[i,r]of Object.entries(s))r&&(n[i]+=o),(n[i]<=0||n[i]>Mn)&&delete n[i];return n},$n=e=>{var t;return(t=Object.entries(e).find(([o,s])=>{if(s.length===0)return;const n=s[s.length-1].type;return go(n)}))==null?void 0:t[0]},xn=e=>{const t=_n(),o=Bt();!t||!o||(Oo({publishId:t,timeStamp:e,type:G.OPEN,sessionId:o}),Te(null))},Hn=(e,t)=>{const o=$n(t),s=Bt();!o||!s||(Oo({publishId:o,timeStamp:e,type:G.CLOSE,sessionId:s}),Te(o))},No=()=>{var n;const e=v();if(!e)return;const t=window.location.href.split("?")[0],o=Lt(),s={appKey:e,sessionUniqueId:Se(),createdAt:new Date().toISOString(),anonymousId:kt(),appUrl:(n=window.Shopify)==null?void 0:n.shop,eventName:vs,parentUrl:t,currentPageProductId:o};tn(s)},Rt={PDP_CAROUSEL:"pdp-carousel",VIDEO_PAGE:"video-page"},L={HEADER:"header",HEADER_AND_BOTTOM_NAVBAR:"header-and-bottom-navbar",CUSTOM_SCREEN:"custom-screen",CUSTOM_SCREEN_AND_BOTTOM_NAVBAR:"custom-screen-and-bottom-navbar"},Ie=e=>document.documentElement.style.setProperty("height",`${e}px`,"important"),Wn=()=>navigator.userAgent.toLowerCase().includes("android"),Vn=e=>{const t=window.screen.availHeight,o=window.Tapcart.variables.device.windowHeight;switch(e){case L.HEADER:return o;case L.HEADER_AND_BOTTOM_NAVBAR:return o;case L.CUSTOM_SCREEN:return t-100;case L.CUSTOM_SCREEN_AND_BOTTOM_NAVBAR:return t-184;default:return o||t}},Fn=e=>{const t=window.screen.availHeight,o=window.Tapcart.variables.device.windowHeight;switch(e){case L.HEADER:return o;case L.HEADER_AND_BOTTOM_NAVBAR:return o-75;case L.CUSTOM_SCREEN:return t-90;case L.CUSTOM_SCREEN_AND_BOTTOM_NAVBAR:return t-175;default:return o||t}},Yn=e=>Wn()?Vn(e):Fn(e),Gn=(e,t)=>{const o=Yn(t.navType);Ie(o)},Kn=e=>`
    <style>
      .tolstoy-video-page iframe {
        display: block !important;
      }
    </style>
    <tolstoy-video-page
      id="tolstoy-tv-container"
      class="tolstoy-video-page"
      data-publish-id="${e}"
    ></tolstoy-video-page>
  `,jn=(e={})=>{const{height:t=490}=e;let o=0;const s=setInterval(function(){o++;const n=document.querySelector(".tolstoy-carousel-container"),i=document.querySelector(".tolstoy-carousel");n&&i?(i.style.display="block",Ie(t),clearInterval(s)):o>=50&&clearInterval(s)},200)},qn=(e,t)=>{Ie(0),jn(t)},zn=e=>{var o,s,n;const t=(n=(s=(o=window==null?void 0:window.Tapcart)==null?void 0:o.variables)==null?void 0:s.product)==null?void 0:n.id;return`
    <style>
      * {
        box-sizing: border-box;
        padding: 0;
        margin: 0;
        font-family: Helvetica;
      }
      
      .tolstoy-carousel iframe {
        display: block !important;
      }
    </style>
    <tolstoy-carousel
      class="tolstoy-carousel"
      data-publish-id="${e}"
      style="display: none"
      ${t?`data-product-id="${t}"`:""}
    ></tolstoy-carousel>
  `},Zn=(e,t)=>h(void 0,null,function*(){switch(t.blockType){case Rt.PDP_CAROUSEL:qn(e,t);break;case Rt.VIDEO_PAGE:Gn(e,t);break}}),Xn=()=>h(void 0,null,function*(){const e=document.querySelectorAll("tolstoy-block");if(e.length!==0)for(const t of Array.from(e)){const{publishId:o,blockType:s,navType:n,height:i}=t.dataset||{},r={blockType:s,navType:n,height:i};let c="";switch(s){case Rt.PDP_CAROUSEL:c=zn(o);break;case Rt.VIDEO_PAGE:c=Kn(o);break}c&&(t.outerHTML=c,Zn(t,r))}}),Qn=()=>{const e=new CustomEvent("tolstoyWidgetReady");window.dispatchEvent(e)},Ul=()=>{const e=new CustomEvent(oo);window.dispatchEvent(e)},Jn=function(){const t=typeof document!="undefined"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),ti=function(e){return"https://widget.gotolstoy.com/we/"+e},Ve={},A=function(t,o,s){if(!o||o.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(o.map(i=>{if(i=ti(i),i in Ve)return;Ve[i]=!0;const r=i.endsWith(".css"),c=r?'[rel="stylesheet"]':"";if(!!s)for(let y=n.length-1;y>=0;y--){const p=n[y];if(p.href===i&&(!r||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${c}`))return;const d=document.createElement("link");if(d.rel=r?"stylesheet":Jn,r||(d.as="script",d.crossOrigin=""),d.href=i,document.head.appendChild(d),r)return new Promise((y,p)=>{d.addEventListener("load",y),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t()).catch(i=>{const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=i,window.dispatchEvent(r),!r.defaultPrevented)throw i})},Uo=({tagName:e,src:t,container:o,attributes:s,style:n,styleString:i,classNames:r,eventListeners:c})=>{const l=document.createElement(e);if(c)for(const[d,y]of Object.entries(c))l.addEventListener(d,y);if(t&&(l.src=t),s)for(const[d,y]of Object.entries(s))l.setAttribute(d,y);if(i&&(l.style.cssText=i),n)for(const[d,y]of Object.entries(n))l.style[d]=y;return r&&l.classList.add(...r),o&&o.append(l),l},Fe=({src:e,container:t,attributes:o})=>Uo({tagName:"script",src:e,container:t,attributes:o}),Dl=({src:e,container:t,attributes:o,style:s})=>Uo({tagName:"iframe",src:e,container:t,attributes:o,style:s}),ei=({callback:e,classNames:t})=>{const o=d=>t.some(y=>d.getElementsByClassName(y).length>0),s=d=>t.includes(d),n=d=>[...d.classList].some(s),i=d=>d.classList?n(d)||o(d):!1,r=d=>d.type!=="childList"||d.addedNodes.length===0?!1:[...d.addedNodes].some(i),c=d=>{d.some(r)&&e()};new window.MutationObserver(c).observe(document.body,{subtree:!0,childList:!0})},oi=({callback:e})=>{window.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e)},Do=({callback:e,classNames:t})=>{oi({callback:e}),"MutationObserver"in window&&ei({callback:e,classNames:t})},kl=({video:e,onError:t})=>e==null?void 0:e.play().catch(t),si=e=>{const t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild},ni=(e,t)=>`${e}-${t}`,ii=(e,t)=>`[data-tolstoy-element="${ni(e,t)}"]`,Bl=(e,t)=>window.document.querySelector(ii(e,t)),$l=(e,t)=>`[${e}="${t}"]`,xl=(e,t)=>window.document.querySelector(`[${e}="${t}"]`),Hl=`<svg style="margin-left: 0.5px; width: 11px !important; height: 10px !important;" width="11" height="10" viewBox="0 0 14 13" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13.0547 12.5938C12.8203 12.8281 12.3906 12.8281 12.1562 12.5938L7 7.39844L1.80469 12.5938C1.57031 12.8281 1.14062 12.8281 0.90625 12.5938C0.671875 12.3594 0.671875 11.9297 0.90625 11.6953L6.10156 6.5L0.90625 1.34375C0.671875 1.10938 0.671875 0.679688 0.90625 0.445312C1.14062 0.210938 1.57031 0.210938 1.80469 0.445312L7 5.64062L12.1562 0.445312C12.3906 0.210938 12.8203 0.210938 13.0547 0.445312C13.2891 0.679688 13.2891 1.10938 13.0547 1.34375L7.85938 6.5L13.0547 11.6953C13.2891 11.9297 13.2891 12.3594 13.0547 12.5938Z" fill="white"/>
</svg>
`,Wl=(e="#FFFFFF")=>`<svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.055 16.594a.662.662 0 0 1-.899 0L10 11.398l-5.195 5.196a.662.662 0 0 1-.899 0 .662.662 0 0 1 0-.899L9.102 10.5 3.906 5.344a.662.662 0 0 1 0-.899.662.662 0 0 1 .899 0L10 9.641l5.156-5.196a.662.662 0 0 1 .899 0 .662.662 0 0 1 0 .899L10.859 10.5l5.196 5.195a.662.662 0 0 1 0 .899Z" style="fill: ${e} !important;"
   /></svg>`,Vl=(e="#fff",t="")=>`<svg class="${t}" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M4 3.532c0-1.554 1.696-2.514 3.029-1.715l14.113 8.468c1.294.777 1.294 2.653 0 3.43L7.029 22.183c-1.333.8-3.029-.16-3.029-1.715V3.532Z" fill="${e}"/></svg>`,Fl='<svg width="10" height="18" viewBox="0 0 10 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.797 16.664.648 9.204A1.071 1.071 0 0 1 .375 8.5c0-.195.078-.43.234-.625L7.758.415a.932.932 0 0 1 1.328-.04c.39.352.39.938.039 1.328L2.602 8.5l6.562 6.875a.932.932 0 0 1-.039 1.328.932.932 0 0 1-1.328-.039Z" fill="#090A0B"/></svg>',Yl='<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.804 6.563 6.902 2.661l.619-.619L12.478 7l-4.983 4.983-.619-.619 3.927-3.926H1.96v-.875z" fill="#fff" stroke="#fff"/></svg>',Gl=`<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="20 16 10 12" fill="none">
  <path d="M22.1274 28L28.1274 22L22.1274 16" stroke="#5C5C5C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,Kl=(e="#fff",t="")=>`
<svg class="${t}" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
  <g clipPath="url(#pauseIcon)">
    <path
      d="M4.375 2.5c-.633 0-1.125.516-1.125 1.125v6.75A1.11 1.11 0 0 0 4.375 11.5h.75c.61 0 1.125-.492 1.125-1.125v-6.75A1.14 1.14 0 0 0 5.125 2.5h-.75Zm4.5 0c-.633 0-1.125.516-1.125 1.125v6.75A1.11 1.11 0 0 0 8.875 11.5h.75c.61 0 1.125-.492 1.125-1.125v-6.75A1.14 1.14 0 0 0 9.625 2.5h-.75Z"
      fill="#fff"
    />
  </g>
  <defs>
    <clipPath id="pauseIcon">
      <path fill="${e}" d="M3 2.5h8v9H3z" />
    </clipPath>
  </defs>
</svg>
`,jl=({color:e="#fff",className:t=""}={})=>`<svg class="${t}" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="Mute tolstoy video"><path d="M6.266 1.551a0.667 0.667 0 0 1 0.382 0.583v7.714c0 0.261 -0.161 0.482 -0.381 0.602a0.651 0.651 0 0 1 -0.703 -0.12L2.85 7.918h-1.346a1.269 1.269 0 0 1 -1.286 -1.286v-1.286c0 -0.703 0.562 -1.286 1.286 -1.286h1.346L5.563 1.671a0.651 0.651 0 0 1 0.703 -0.12Zm2.492 2.651 1.105 1.106 1.105 -1.106c0.18 -0.18 0.483 -0.18 0.663 0 0.201 0.201 0.201 0.502 0 0.683L10.526 5.991l1.106 1.104c0.201 0.201 0.201 0.502 0 0.683a0.44 0.44 0 0 1 -0.663 0l-1.106 -1.105 -1.104 1.106c-0.201 0.201 -0.502 0.201 -0.683 0 -0.201 -0.182 -0.201 -0.483 0 -0.684l1.105 -1.105L8.073 4.886c-0.2 -0.18 -0.2 -0.482 0 -0.683 0.182 -0.18 0.483 -0.18 0.684 0Z" fill="${e}"/></svg>`,ql=({color:e="#fff",className:t=""}={})=>`<svg class="${t}" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="Unmute tolstoy video"><path d="M6.627 1.55c.238.101.411.342.411.583v7.714c0 .261-.173.482-.411.603a.742.742 0 0 1-.757-.121l-2.921-2.41H1.5c-.779 0-1.385-.563-1.385-1.286V5.347c0-.703.606-1.286 1.385-1.286h1.449l2.921-2.39a.742.742 0 0 1 .757-.121Zm3.721 1.447c.931.723 1.537 1.788 1.537 2.993 0 1.225-.606 2.29-1.537 2.993a.542.542 0 0 1-.735-.06c-.195-.201-.152-.502.065-.683.714-.522 1.168-1.326 1.168-2.25 0-.904-.454-1.708-1.168-2.23a.475.475 0 0 1-.065-.683.565.565 0 0 1 .735-.08ZM9.029 4.503c.476.362.779.884.779 1.487 0 .623-.303 1.145-.779 1.507a.55.55 0 0 1-.736-.081.454.454 0 0 1 .087-.663.966.966 0 0 0 .389-.763.928.928 0 0 0-.389-.743.475.475 0 0 1-.087-.683.57.57 0 0 1 .736-.061Z" fill="${e}"/></svg>`,ri=()=>`
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ff0000" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-alert"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
`,ai=()=>`
<svg width="40" height="20" xmlns="http://www.w3.org/2000/svg">
    <rect width="40" height="20" rx="3" ry="3" style="fill:blue;"/>
    <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="8" font-weight="normal" fill="white" letter-spacing="0.1px">
        Publish
    </text>
</svg>
`;class ci{constructor(t){g(this,"postMessage",t=>{var o;(o=this.broadcaster)==null||o.postMessage(t)});g(this,"addEventListener",(...t)=>{var o;(o=this.receiver)==null||o.addEventListener(...t)});this.name=t||po();try{"BroadcastChannel"in self&&(this.broadcaster=new BroadcastChannel(this.name),this.receiver=new BroadcastChannel(this.name))}catch(o){console.error("self is not defined",o)}}}class ko{constructor({shouldIncludeLogs:t=!1,shouldArchivePastEvents:o=!1}={}){g(this,"subscribeMultipleEvents",({eventNames:t,callback:o,shouldIncludePastEvents:s})=>{for(const n of t)this.subscribe({eventName:n,callback:o,shouldIncludePastEvents:s})});g(this,"unsubscribeMultipleEvents",({eventNames:t,callback:o})=>{for(const s of t)this.unsubscribe({eventName:s,callback:o})});this.broadcastHub=new ci,this.eventCallbacks={},this.pastEvents={},this.shouldIncludeLogs=t,this.shouldArchivePastEvents=o}logMessage(t){this.shouldIncludeLogs&&console.log(t)}throwError(t){if(this.shouldIncludeLogs)throw new Error(t)}archivePastEvent(t){if(!this.shouldArchivePastEvents)return;const{eventName:o}=t;this.pastEvents[o]||(this.pastEvents[o]=[]),this.pastEvents[o].push(t)}postMessage(t){this.archivePastEvent(t),this.broadcastHub.postMessage(t)}postPastEvents({eventName:t,callback:o}){if(this.pastEvents[t])for(const s of this.pastEvents[t])o({data:w(m({},s),{isPastEvent:!0})})}subscribe({eventName:t,callback:o,shouldIncludePastEvents:s}){if(this.eventCallbacks[t]||(this.eventCallbacks[t]=new Set),this.eventCallbacks[t].has(o)){this.throwError(`Already subscribed to event ${t} with this callback`);return}this.eventCallbacks[t].add(o),s&&this.postPastEvents({eventName:t,callback:o})}unsubscribe({eventName:t,callback:o}){if(!this.eventCallbacks[t]){this.throwError(`Not subscribed to event ${t}`);return}if(!this.eventCallbacks[t].has(o)){this.throwError("Callback is not subscribed");return}if(!this.eventCallbacks[t].delete(o)){this.logMessage(`Not subscribed to event ${t} with this callback`);return}this.logMessage(`Unsubscribed from event ${t}`)}initListener(t){this.broadcastHub.addEventListener("message",t)}}class ot extends ko{constructor(){if(ot.instance)return ot.instance;super({shouldArchivePastEvents:!0});g(this,"eventHandler",o=>{const{data:s={}}=o,{eventName:n}=s;if(this.eventCallbacks[n])for(const i of this.eventCallbacks[n])i(o)});g(this,"postMessage",o=>{const s=o.transmissionId||po();return super.postMessage(w(m({},o),{transmissionId:s})),s});g(this,"init",()=>{this.initListener(this.eventHandler)});ot.instance=this}}const u=new ot;Object.freeze(u);const li={modalOpen:"tolstoyModalOpen",playerReady:"tolstoyPlayerReady",toggleFeedCloseButton:"toggleFeedCloseButton",showFeedProductModal:"showFeedProductModal",reportModalOpen:"tolstoyReportModalOpen",reportModalClose:"tolstoyReportModalClose",modalMessagingReady:"tolstoyModalMessagingReady",closePlayer:"tolstoyClosePlayer",userEmailUpdate:"tolstoyUserEmailUpdate"},di={isRebuyAppInstalled:"tolstoyIsRebuyAppInstalled",openRebuyCart:"tolstoyOpenRebuyCart",rebuyCartShown:"rebuyCartShown",rebuyCartHidden:"rebuyCartHidden"},ui={openKendoModal:"tolstoyOpenKendoModal",changeZIndex:"tolstoyChangeZIndex"},pi={isTapcart:"tolstoyIsTapcart",openTapcartProduct:"tolstoyOpenTapcartProduct"},hi={getProductsMetafields:"getProductsMetafields",returnProductsMetafields:"returnProductsMetafields"},yi={isAfterpayAppInstalled:"tolstoyIsAfterpayAppInstalled"},gi={productCardClick:"tolstoyProductCardClick"},mi={spotlightCarouselQuickShopClick:"tolstoySpotlightCarouselQuickShopClick"},Ei={externalEventSubscribed:"tolstoyExternalEventSubscribed",productCardClickSubscribed:"tolstoyProductCardClickSubscribed"},wi={setAnonymousIdToCart:"tolstoySetAnonymousIdToCart",blockAnonymousIdToCart:"tolstoyBlockAnonymousIdToCart",addToCart:"tolstoyAddToCart",addToCartSuccess:"tolstoyAddToCartSuccess",addToCartError:"tolstoyAddToCartError",addToCartSoldOut:"tolstoyAddToCartSoldOut",addToCartDisableDefault:"tolstoyAddToCartDisableDefault",cartItemQuantityChange:"tolstoyCartItemQuantityChange",cartItemQuantityChangeSuccess:"tolstoyCartItemQuantityChangeSuccess",cartItemQuantityChangeError:"tolstoyCartItemQuantityChangeError",cartDataRequest:"tolstoyCartDataRequest",cartDataResponse:"tolstoyCartDataResponse"},fi={loginWithMultipassUrlRequest:"tolstoyLoginWithMultipassUrl",loginWithMultipassUrlResponse:"tolstoyLoginWithMultipassUrlResponseMessage"},Si={productRecommendationsRequest:"tolstoyProductRecommendationsRequest",productRecommendationsResponse:"tolstoyProductRecommendationsResponse"},Ti={requestProductsUpdate:"tolstoyRequestProductsUpdate",productUpdateResponse:"tolstoyProductUpdateResponse",moveToUrl:"tolstoyMoveToUrl",isNonBaseCurrency:"tolstoyIsNonBaseCurrency"},Ii={urlChange:"urlChange",urlLocaleUpdate:"tolstoyUrlLocaleUpdate"},bi={openCommerceSettingsUpdate:"tolstoyOpenCommerceSettingsUpdate"},a=w(m(m(m(m(m(m(m(m(m(m(m(m(m(m(m({},li),di),ui),yi),hi),gi),mi),Ei),pi),wi),fi),Si),Ti),Ii),bi),{rejectCookiePolicy:"rejectCookiePolicy"}),Bo="widget-loading",zl="widget-onyou",Zl="widget-onyou-enableAllPages",Ci="widget-video-fallback",Xl="carousel-show-dots",Ql="carousel-videos",Jl="hide-spotlight-plus-button",td="app-use-creator-profile",_i="block-shopify-add-to-cart-attribute",ed="shopify-price-formatting",vi="Nunito Sans, sans-serif",od="tolstoy-custom-font-family",sd="tolstoy-custom-heading-font-family",Ye=[];function Ai(e,t){const o="italic",s="normal",n={".ttf":"truetype",".otf":"opentype",".woff":"woff",".woff2":"woff2"},i=document.createElement("style");for(const r of Object.keys(e)){const c=e[r],l=r.includes(o),d=r.split("-")[1]||r.replace(o,"")||s,y=l?o:s,p=Object.keys(n).find(_=>c.includes(_)),b=n[p],S=c.replace("http://","https://");i.append(document.createTextNode(`@font-face { font-family: '${t}'; src: url("${S}") format("${[b]}"); font-weight: ${d}; font-style: ${y}; font-display: swap;}`))}document.head.append(i)}const $o=(e,t=1)=>{if(!(!e||t===3)){if(!document.querySelector("#tolstoyWidgetElement")){setTimeout(()=>{$o(e,t+1)},1e3);return}document.querySelector("#tolstoyWidgetElement").style.fontFamily=`${e}, ${vi}`}},Oi=e=>{const t=document.head.querySelectorAll("style");return Array.from(t).some(o=>o.textContent.includes(`@font-face { font-family: '${e}';`))};function Ge(e,t="tolstoy-custom-font-family"){if(!e||Ye.includes(t)||Oi(t))return;const{sources:o}=e;Ai(o,t),$o(t),Ye.push(t)}let tt,Ke="";const Pi=e=>{var o;const t=document.querySelector("#smile-ui-container");e&&(Ke=(t==null?void 0:t.style.display)||""),(o=t==null?void 0:t.style)==null||o.setProperty("display",e||Ke)},Ri=e=>{let t=0;return o=>{try{o()}catch(s){try{if(!O())return;fetch("https://api.gotolstoy.com/events/event",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({eventName:"widgetError",text:s.message,timestamp:new Date().toISOString(),parentUrl:window.location.href,appKey:e.data.appKey,publishId:e.data.publishId,sessionId:e.data.sessionId,source:e.data.name,answerKey:`${t}`,currentPageProductId:o.toString(),formData:`${(s&&s.stack||"").slice(0,1999)}`})})}catch(n){yo(n)}}finally{t++}}},Mi=e=>{if(e.data.name===E.sessionStart||e.data.name===M.autoplayStart){const t=Ri(e);t(()=>pn(e.data.publishId)),t(()=>bn(e.data.appKey)),t(()=>Lo(e.data.sessionId)),t(()=>vn(e.data.publishId,e.data.sessionId)),t(()=>Pi("none")),t(()=>Li(e.data.anonymousId))}},Li=e=>{window.Shopify&&u.postMessage({eventName:a.setAnonymousIdToCart,anonymousId:e})},nd=({data:{name:e,publishId:t,productIds:o}={}})=>{if(e===hs)for(const s of o)hn({productId:s,publishId:t})},id=e=>{qe[e.data.name]&&qe[e.data.name](e.data)},rd=e=>{ze[e.data.name]&&setTimeout(()=>ze[e.data.name](),500)},Ni=()=>{var e,t;window.GorgiasChat&&((t=(e=window.GorgiasChat).open)==null||t.call(e),window.tolstoyWidget.hide(),document.head.insertAdjacentHTML("beforeend","<style>#gorgias-chat-container iframe#chat-button { visibility: visible !important; display: block !important; }</style>"))},Ui=()=>{var e,t;window.GorgiasChat&&((t=(e=window.GorgiasChat).close)==null||t.call(e),document.head.insertAdjacentHTML("beforeend","<style>#gorgias-chat-container iframe#chat-button { visibility: hidden; display: none; }</style>"))},Di=()=>{window.adaEmbed&&(window.adaEmbed.toggle(),window.tolstoyWidget.hide())},ki=()=>{document.head.insertAdjacentHTML("beforeend","<style>#ada-button-frame { display: none; }</style>")},Bi=()=>{window.fcWidget&&(window.fcWidget.show(),window.fcWidget.open(),window.tolstoyWidget.hide())},$i=()=>{window.fcWidget&&(window.fcWidget.close(),window.fcWidget.hide(),window.tolstoyWidget.show())},xi=()=>{var e,t;if(!tt&&((e=window.Reamaze)!=null&&e.popup)){window.Reamaze.popup(),window.tolstoyWidget.hide();return}window._support&&tt&&((t=window.Reamaze)!=null&&t.reload)&&(window._support.ui=tt,window.Reamaze.reload(),tt=null,window.tolstoyWidget.hide())},Hi=()=>{var e,t;(e=window._support)!=null&&e.ui&&((t=window.Reamaze)!=null&&t.reload)&&(tt=window._support.ui,delete window._support.ui,window.Reamaze.reload(),window.tolstoyWidget.show())},Wi=()=>{const e=setTimeout(()=>clearInterval(t),9e3),t=setInterval(()=>{window.Intercom&&(window.Intercom("show"),window.tolstoyWidget.hide(),clearInterval(t),clearTimeout(e),window.Intercom("onHide",()=>{window.tolstoyWidget.show()}))})},Vi=()=>{const e=setTimeout(()=>clearInterval(t),9e3),t=setInterval(()=>{window.Intercom&&(window.Intercom("update",{hide_default_launcher:!0}),clearInterval(t),clearTimeout(e))},100)},Fi=()=>{window.Tawk_API&&(window.Tawk_API.maximize(),window.tolstoyWidget.hide())};function Yi(){window.Tawk_API&&window.Tawk_API.hideWidget()}const Gi=()=>{window.LiveChatWidget&&(window.LiveChatWidget.call("maximize"),window.tolstoyWidget.hide())};function Ki(){window.LiveChatWidget&&window.LiveChatWidget.call("hide")}const ji=()=>{window.HubSpotConversations&&window.HubSpotConversations.widget&&(window.HubSpotConversations.widget.open(),window.tolstoyWidget.hide())};function qi(){window.HubSpotConversations&&window.HubSpotConversations.widget&&window.HubSpotConversations.widget.close()}const zi=()=>{window.Beacon&&(window.Beacon("open"),window.tolstoyWidget.hide(),window.Beacon("config",{display:{zIndex:"99999"}}))},Zi=()=>{window.Beacon&&window.Beacon("config",{display:{zIndex:"0"}})},Xi=()=>{window.drift&&(window.drift.api.toggleChat(),window.tolstoyWidget.hide())},Qi=()=>{window.drift&&window.drift.api.widget.hide()},Ji=()=>{var e,t;window.zE&&(window.zE("messenger","open"),(t=(e=document.querySelector('[title="Button to launch messaging window"]'))==null?void 0:e.style)==null||t.setProperty("display","block"),window.tolstoyWidget.hide())},tr=()=>{const e=setTimeout(()=>clearInterval(t),5e3),t=setInterval(()=>{var n,i,r;const o=document.querySelector('[title="Button to launch messaging window"]'),s=document.querySelector('[title="Message from company"]');(n=o==null?void 0:o.style)==null||n.setProperty("display","none"),(r=(i=s==null?void 0:s.parentElement)==null?void 0:i.style)==null||r.setProperty("display","none"),o&&s&&(clearInterval(t),clearTimeout(e))},100);window.zE&&window.zE("messenger","close")},er=()=>{window.tidioChatApi&&(window.tidioChatApi.show(),window.tidioChatApi.open(),window.tolstoyWidget.hide())},or=()=>{window.tidioChatApi&&window.tidioChatApi.close()},sr=e=>{if(window.certainly)switch(window.certainly.widgetStatus({action:"open"}),window.tolstoyWidget.hide(),e.data.key){case"PmkMI":window.certainly.goTo({module:"670442"});break;case"_23Hl":window.certainly.goTo({module:"670178"});break;case"P9rfq":window.certainly.goTo({module:"670179"});break}},nr=()=>{window.certainly&&window.certainly.widgetStatus({action:"hide"})},je=e=>{document.head.insertAdjacentHTML("beforeend",`<style>${e} { visibility: hidden; display: none; }</style>`)},ir=()=>{je("#vfChat+div"),je("#vfChat+div+div")},rr="tolstoyHideFreshChat",ar="tolstoyOpenFreshChat",cr="tolstoyHideReamaze",lr="tolstoyOpenReamaze",dr="tolstoyHideAda",ur="tolstoyOpenAda",pr="tolstoyHideTidio",hr="tolstoyOpenTidio",yr="tolstoyHideCertainly",gr="tolstoyOpenCertainly",mr="tolstoyHideVfChat",qe={[E.openGorgias]:Ni,[E.openIntercom]:Wi,[E.openTawkTo]:Fi,[E.openLiveChat]:Gi,[E.openHubSpot]:ji,[E.openDrift]:Xi,[E.openZendesk]:Ji,[E.openHelpScout]:zi,[ar]:Bi,[lr]:xi,[ur]:Di,[hr]:er,[gr]:sr},ze={[E.hideGorgias]:Ui,[E.hideIntercom]:Vi,[E.hideTawkTo]:Yi,[E.hideLiveChat]:Ki,[E.hideHubSpot]:qi,[E.hideDrift]:Qi,[E.hideZendesk]:tr,[E.hideHelpScout]:Zi,[rr]:$i,[cr]:Hi,[dr]:ki,[mr]:ir,[pr]:or,[yr]:nr};class Er{constructor({config:t,playerType:o,collectionId:s}){this.config=t,this.publishId=t.publishId,this.playerType=o,this.sessionId=Bt()||Ot(),this.anonymousId=kt(),this.currentPageProductId=Lt(),this.collectionId=s,this.errors={}}getIsMobile(){return window.screen.width<=450||window.screen.height<=450}getAnalyticsParams(t={}){var d;const{id:o,appKey:s,name:n,googleAnalyticsID:i}=this.config,r=window.location.href.split("?")[0],c=(d=window.Shopify)==null?void 0:d.shop,l=this.errors;return m({appKey:s,publishId:this.publishId,sessionId:this.sessionId,anonymousId:this.anonymousId,currentPageProductId:this.currentPageProductId,isMobile:this.getIsMobile(),pageUrl:r,storeUrl:c,appUrl:c,googleAnalyticsID:i,projectId:o,playlist:n,timestamp:new Date().toISOString(),parentUrl:window.location.href,playerType:this.playerType,customParams:l?JSON.stringify(l):void 0,collectionId:this.collectionId},t)}sendEventToAllSources(t){ce(t),Yt({data:w(m({},t),{name:t.eventName})})}sendEventImmediately(t={},o=!1){const s=this.getAnalyticsParams(t);fo(s),!o&&Yt({data:w(m({},s),{name:s.eventName})})}sendEvent(t={},o=!1){if(!O())return;const s=this.getAnalyticsParams(t);s.eventName===f.onYouClick&&console.log("Analytics::sendEvent::params",s),ce(s),!o&&Yt({data:w(m({},s),{name:s.eventName})})}handlePageView(){Gt(this.publishId,!1),this.sendEvent({eventName:f.pageView})}handleEmbedView(){Gt(this.publishId,!0),this.sendEvent({eventName:f.embedView})}handleOnYouClick(){Gt(this.publishId,!0),Lo(this.sessionId),this.sendEvent({eventName:f.onYouClick})}handleSessionStart(){const t=this.getAnalyticsParams({eventName:f.sessionStart});this.sendEventToAllSources(t),Mi({data:w(m({},t),{name:E.sessionStart})}),window.postMessage(w(m({},t),{name:E.sessionStart}),"*")}handleVideoLoaded(t={}){const o=this.getAnalyticsParams(w(m({},t),{eventName:f.videoLoaded}));this.sendEventToAllSources(o)}handleVideoWatched(t={}){const o=this.getAnalyticsParams(w(m({},t),{eventName:f.videoWatched}));this.sendEventToAllSources(o)}}const Kt={A:"A",B:"B"};class wr{constructor(t){this.widgetType=t}sendAbTestInitializedEvent({abTestId:t,group:o,excludeExternalAnalytics:s,probability:n}){const i={abTestId:t,eventName:f.abTestInitialized,sessionUniqueId:Se(),testGroup:o,probability:n};this.analytics.sendEventImmediately(i,s)}initializeGroup({abTestId:t,probability:o,excludeExternalAnalytics:s}){const n=Rn(t);if(n){this.group=n;return}const r=Math.random()>o?Kt.B:Kt.A;this.group=r,this.sendAbTestInitializedEvent({abTestId:t,group:r,excludeExternalAnalytics:s,probability:o}),Pn(t,r)}init(t){if(!t)return;const{abTestSettings:o={}}=t,{isEnabled:s,abTestId:n,probability:i,groupASettings:r={},groupBSettings:c={},excludeExternalAnalytics:l}=o;if(s)return this.analytics=new Er({config:t,playerType:this.widgetType}),this.initializeGroup({abTestId:n,probability:i,excludeExternalAnalytics:l}),this.group===Kt.A?r:c}}const be=({config:e,featureKey:t})=>{var o;return(o=e==null?void 0:e.featureSettings)==null?void 0:o[t]},fr=({config:e,featureKey:t})=>{var o;return!!((o=e==null?void 0:e.featureSettings)!=null&&o[t])},ad=(e={})=>{const t=be({config:e,featureKey:Bo});return t==null?void 0:t.playerLazy},xo=(e={})=>{const t=be({config:e,featureKey:Bo});return t==null?void 0:t.playerOrigin},cd=(e={})=>{const t=be({config:e,featureKey:Ci});return t==null?void 0:t.dontUseFallback},ld=".webp",dd={VIDEO:"video",IMAGE:"image",GALLERY:"gallery"},J={XS:250,S:480,M:960,L:1280,XL:1920},ud={[J.XS]:"_250",[J.S]:"_480",[J.M]:"_960",[J.L]:"_1280",[J.XL]:"_1920"},Ho={"250x140":"250x140","250x250":"250x250","480x480":"480x480","960x540":"960x540"},Wo=({path:e=`${uo}/public`,ownerId:t="",assetId:o="",suffix:s="",extension:n=""})=>`${e}/${t}/${o}/${o}${s}${n}`,pd=({stockAsset:e={},posterSettings:t={}})=>{const{useShopifyPoster:o=!0}=t,{shopifyPosterUrl:s,posterUrl:n}=e||{};return s&&o?s:n},Sr=({step:e,extension:t,posterSettings:o,size:s=Ho["250x250"],custom:n={condition:"",callback:""},path:i=`${uo}/public`})=>{var z;const{videoOwner:r,videoId:c,stockAsset:l={},mediaAssets:d}=e;if(!c)return"";const{avatarUrl:y,posterUrl:p,hasOriginal:b,shopifyPosterUrl:S}=l||{},{shopifyAttributes:_={},shopifySpotlightAttributes:F={},useShopifyPoster:B=!1}=o||{},q=m(m({},_),F),Et=!!((z=Object.keys(q))!=null&&z.length),Ce=S&&B&&Et;if(p)return p;if(d&&(d!=null&&d.images)&&(d!=null&&d.images[s])&&!Ce)return d.images[s];const wt=!b&&(y||p);if(S&&!1){let Z="width=300";return B&&(Z=new URLSearchParams(q).toString()),`${S}&${Z}`}return p!=null&&p.endsWith(t)||p&&!b?p:n!=null&&n.condition&&(n!=null&&n.callback)&&n.condition({posterUrl:p,avatarUrl:y,extension:t,isDuplicated:wt})?n.callback(l):Wo({path:i,ownerId:r,assetId:c,extension:t})},Tr=".avatar.0000000.webp",Ir=".401.0000000.webp",hd=".avatar.0000000.jpg",yd=".0000000.jpg",br=480,Cr=({isMobile:e,isStory:t,isPlayInTileFirst:o,isTile:s})=>o||s?"_640.mp4":e||t?"_preview.mp4":"_preview_embed.mp4",Ze=({step:e,isStory:t,isPlayInTileFirst:o,height:s=Es,isTile:n})=>{const{videoOwner:i,stockAsset:r,videoId:c}=e,l=window.innerWidth<=450,d=Cr({isMobile:l,isStory:t,isPlayInTileFirst:o,isTile:n}),y=r==null?void 0:r.videoUrl,p=!!(r!=null&&r.shopifyFileId),b=r==null?void 0:r.previewUrl,S=r==null?void 0:r.hasOriginal,_=r==null?void 0:r.gifUrl,F=p&&!S;return b&&!o&&s<br&&!n?b:y&&p?y:y&&!p?y!=null&&y.includes("vimeo")?y:`${y.split(".mp4")[0]}${d}`:_&&F?`${_.split(".mp4")[0]}${d}`:Wo({ownerId:i,assetId:c,extension:d})},gd=(e,t,o=Ho["480x480"])=>{const n=window.innerWidth<=450?Tr:Ir;return Sr({step:e,extension:n,posterSettings:t,size:o})},md=(e,t)=>{const o=()=>{if(e.autoplay){e.src="";return}e.src=t};e.addEventListener("ended",o,{once:!0})},_r=(e,t,o)=>o?`${e}-${t}-${o}`:`${e}-${t}`,Ed=e=>e.dataset.publishId?e.dataset.publishId:e.id?e.id.split("_")[0]:"",wd=e=>{var t;return(t=e==null?void 0:e.dataset)==null?void 0:t.collectionId},fd=e=>{var s,n,i,r,c,l;const t=(i=(n=(s=e==null?void 0:e.design)==null?void 0:s.branding)==null?void 0:n.typography)==null?void 0:i.font,o=(l=(c=(r=e==null?void 0:e.design)==null?void 0:r.branding)==null?void 0:c.typography)==null?void 0:l.fontHeading;!(t!=null&&t.family)&&!(o!=null&&o.family)||(t!=null&&t.family&&Ge(t),o!=null&&o.family&&Ge(o,"tolstoy-custom-heading-font-family"))},Sd=({step:e,embedMotion:t,isStory:o,loadAll:s=!1,isCarouselPlayInTileFirst:n})=>{if(t===et.static||n)return null;const r=window.innerWidth<=450,c=t===et.hoverOver,l=t===et.dynamic;return l&&s?Ze({step:e,isStory:o}):c&&r||l?null:Ze({step:e,isStory:o})},vr=e=>{const t=e.getBoundingClientRect();return t.top>=-t.height&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},Vo=(e,t)=>window.document.querySelectorAll(`[data-tolstoy-element="${_r(e,t)}"]`),Ar=({videoClass:e,publishId:t,removeEventListenerFunction:o})=>{const s=Vo(e,t);for(const n of s)n.pause(),o==null||o(n)},Or=({videoClass:e,publishId:t,setIsDynamicVideoRunning:o,onVideoEnd:s})=>{o(!1),Ar({videoClass:e,publishId:t,removeEventListenerFunction:n=>{n.removeEventListener("ended",s)}})},Td=({videoClass:e,isDynamicVideoRunning:t,setIsDynamicVideoRunning:o,dynamicVideoHandler:s,publishId:n,onVideoEnd:i})=>{const r=Vo(e,n);if(r.length===0)return;const c=vr(r[0]);!c&&t?(Or({videoClass:e,publishId:n,setIsDynamicVideoRunning:o,onVideoEnd:i}),o(!1)):c&&!t&&(s(),o(!0))},Id=r=>h(void 0,[r],function*({publishId:e,productId:t,widgetType:o,tags:s,appUrl:n,variantId:i}){const c=t&&t!==Os?Zs:zs,l=window.tolstoyAppKey||v()||"",d=new URLSearchParams(window.location.search),y=i||d.get("variant"),p=yield c({productId:t,defaultPublishId:e,widgetType:o,appKey:l,tags:s,appUrl:n,variantId:y});return(new wr(o).init(p)||{}).hideElement?{disabled:!0}:(p!=null&&p.disabled||(fr({config:p,featureKey:_i})&&u.postMessage({eventName:a.blockAnonymousIdToCart,appKey:l}),p!=null&&p.openCommerceSettings&&u.postMessage({eventName:a.openCommerceSettingsUpdate,openCommerceSettings:p.openCommerceSettings})),p)});function bd(e,t){return!!(t==null?e:!t)}const Cd=e=>{const t=c=>{const l=si(c);return l.style.verticalAlign="middle",l.style.margin="0 5px",l.style.marginBottom="3px",l},o=document.createElement("p"),s=t(ri()),n=t(ai());return o.append(s),({"Invalid publishId":["Add the publish ID from the",n,"tab of your project in Tolstoy"],"Project is not live":["Your project is in draft. Publish project in the",n," tab of your project in Tolstoy"],"Project is deleted":["Project has been deleted"],"No videos found":["Select videos in the Videos tab of your project in Tolstoy"],"No filtered videos found":["Select videos in the Videos tab of your project in Tolstoy"],"No connections found":["Select videos in the Videos tab of your project in Tolstoy"],"No videos found for product":["Add tagged videos for this product in the Videos tab of your project in Tolstoy"]}[e]||["Couldn't find product page"]).forEach(c=>{typeof c=="string"?o.append(document.createTextNode(c)):o.append(c)}),o},Pr=({element:e})=>{const t=e.getBoundingClientRect();return t.width===0||t.height===0?!1:t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},_d=()=>new URLSearchParams(window.location.search).get("variant"),jt="data-status",Rr=[ut],Tt={loading:"loading",loaded:"loaded",failed:"notFound"},Mr=({element:e,callback:t,outOfViewCallback:o})=>{const s=new window.IntersectionObserver(n=>{n[0].isIntersecting===!0&&n[0].intersectionRatio>.9?(o||s.unobserve(e),t()):n[0].intersectionRatio<.1&&(o==null||o())},{threshold:[.1,.9]});s.observe(e)},Lr=e=>{const t=e.attributes,o={};for(const s of t)o[s.name]=s.value;return o};class Nr{constructor({name:t,component:o,elementClassname:s,preloadedConfigs:n}){this.name=t,this.Component=o,this.widgets=[],this.initialized=!1,this.elementClassname=s,this.preloadedConfigs=Array.isArray(n)?n:[],this.initAdditionalTemplates()}init(){return h(this,null,function*(){const t=this.getElements();if(t.length!==0){for(const o of t)if(this.getShouldInitializeElement(o)){this.setElementStatus(o,Tt.loading);try{const s=new this.Component;if(yield s.init(o,this.preloadedConfigs.find(n=>n.projectId===o.dataset.projectId)),!s.getIsInitialized()){this.setElementStatus(o,Tt.failed);continue}this.widgets.push(s),this.initializeEvents({element:o,widget:s}),this.setElementStatus(o,Tt.loaded)}catch(s){this.setElementStatus(o,Tt.failed),console.log(`error starting  tolstoy ${this.name}`,o.id,s)}}this.widgets.length>0&&(this.initialized=!0)}})}deleteElementStatus(t){delete t.removeAttribute(jt)}getElementStatus(t){return t.getAttribute(jt)}getIsTolstoyPreview(){return window.tolstoyPreview}getIsElementHidden(t){var o;return((o=window.getComputedStyle(t))==null?void 0:o.display)==="none"||!t.offsetParent}setElementStatus(t,o){return t.setAttribute(jt,o)}getShouldInitializeElement(t){return t.classList.contains(so)&&!this.getElementStatus(t)?!0:!this.getElementStatus(t)&&!this.getIsElementHidden(t)||!this.getElementStatus(t)&&mt()||this.getIsTolstoyPreview()}setComponent(t){this.Component=t}initAdditionalTemplates(){var t;if(ut===this.name&&((t=this.preloadedConfigs)!=null&&t.length)&&!document.querySelector(`.${ee.collectionTile}`)){const o=[...document.querySelectorAll("img")].map(s=>({element:s,attrs:Lr(s)}));this.preloadedConfigs.forEach(({config:s,project:n,collectionId:i})=>{!s||!n||!i||Object.entries((s==null?void 0:s.productsMap)||{}).forEach(([r,c])=>{var p,b;if(!((p=c==null?void 0:c.image)!=null&&p.src))return;const d=new URL(c.image.src).pathname.split("/").pop().split(".").slice(0,-1).join("."),y=(b=o.find(({attrs:S})=>Object.values(S).some(_=>_.includes(d))))==null?void 0:b.element;if(y){const S=document.createElement("div");S.innerHTML=`<tolstoy-collection-tile
                style="z-index:1"
                data-collection-id="${i}"
                class="${ee.collectionTile}"
                data-publish-id="${n.publishId}"
                data-product-id="${r}"
              ></tolstoy-collection-tile>`,y.parentElement.insertBefore(S.firstChild,y)}})})}}getElements(){return Rr.includes(this.name)?[document.querySelector(`.${this.elementClassname}`)].filter(Boolean):[...document.querySelectorAll(`.${this.elementClassname}`)]}shouldLoad(){return this.getElements().length>0}initializeEvents({element:t,widget:o}){var s;(s=o.handlePageView)==null||s.call(o),this.registerEmbedViewListener({element:t,callback:o.handleView,outOfViewCallback:o.handleOutOfView})}registerEmbedViewListener({element:t,callback:o,outOfViewCallback:s}){Pr({element:t})&&(o(),!s)||Mr({element:t,callback:o,outOfViewCallback:s})}}let Xe=!1;const Fo=()=>h(void 0,null,function*(){if(Xe)return;(yield A(()=>import("./9b77a289d/widget.events.b40d3808.js"),[])).initializeWidgetEvents(),Xe=!0});class Ur{constructor(){g(this,"loadEmbedWidgets",()=>h(this,null,function*(){const t=Object.entries(this.embedWidgetsMap).map(r=>h(this,[r],function*([o,{embedWidget:s,loaded:n,loading:i}]){if(s.shouldLoad()){if(i){setTimeout(()=>this.loadEmbedWidgets(),2e3);return}n||(yield this.loadEmbedWidget({embedWidgetName:o,embedWidget:s})),yield s.init()}}));yield Promise.all(t)}));g(this,"handleUrlChange",()=>{for(const t of Object.keys(this.embedWidgetsMap))this.embedWidgetsMap[t].loaded=!1;this.loadEmbedWidgets()});this.domUpdatesListenerInitialized=!1,this.widgets=[],this.embedWidgetsMap={}}init(t){return h(this,null,function*(){const o=[],s=[oe,se,ne,ie,ut];for(const n of s){const i=ao[n],r=new Nr({name:n,elementClassname:i,preloadedConfigs:t});this.embedWidgetsMap[n]={embedWidget:r,loaded:!1},o.push(i)}this.registerDomUpdatesListenerIfNeeded(o),this.subscribeToUrlChange(),yield this.loadEmbedWidgets()})}loadEmbedWidget(s){return h(this,arguments,function*({embedWidgetName:t,embedWidget:o}){this.embedWidgetsMap[t].loading=!0;let n;switch(t){case oe:{n=yield A(()=>import("./9b77a289d/carousel-loader.ba74de6b.js"),[]);break}case se:{n=yield A(()=>import("./9b77a289d/story.9343752d.js"),["9b77a289d/modal.eb93a2a4.css","9b77a289d/story.28102514.css"]);break}case ne:{n=yield A(()=>import("./9b77a289d/embed.c549f919.js"),["9b77a289d/modal.eb93a2a4.css","9b77a289d/embed.550ffe5d.css"]);break}case ie:{n=yield A(()=>import("./9b77a289d/tile.c26465dd.js"),["9b77a289d/tile.4607c378.css"]);break}case ut:{n=yield A(()=>import("./9b77a289d/collection-tile-controller.7d5bd1dc.js"),["9b77a289d/collection-tile-controller.af177681.css"]);break}case ro:{n=yield A(()=>import("./9b77a289d/collection-page-tile-controller.75937526.js"),["9b77a289d/collection-page-tile-controller.5d04a287.css"]);break}}o.setComponent(n.default),yield Fo(),this.embedWidgetsMap[t].loaded=!0,this.embedWidgetsMap[t].loading=!1})}registerDomUpdatesListenerIfNeeded(t){if(this.domUpdatesListenerInitialized)return;Do({classNames:t,callback:()=>this.loadEmbedWidgets()}),this.domUpdatesListenerInitialized=!0}subscribeToUrlChange(){u.subscribe({eventName:a.urlChange,callback:this.handleUrlChange})}}const x=no,Dr=new Set(["5bzilmwoe1fon","z7uu0kcyzumt0"]),Yo=e=>Dr.has(e)?io:x;class kr{constructor(){this.initialized=!1,this.widgets=[],this.start=this.start.bind(this),this.startPart=this.startPart.bind(this),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.on=this.on.bind(this),this.recreate=this.recreate.bind(this),window.tolstoyWidget=w(m({},window.tolstoyWidget),{start:this.start,startPart:this.startPart,show:this.show,hide:this.hide,on:this.on,recreate:this.recreate})}init(n){return h(this,arguments,function*({bubbleSettings:t,widgetId:o,Component:s}){var c,l;this.bubbleSettings=t;const i=new s(t);if(yield i.init(),this.widgets.push(i),this.updateViewerIdentifyAttributes(),(c=window.tolstoySettings)!=null&&c.noReload||this.registerEvents(),(((l=window.tolstoySettings)==null?void 0:l.alwaysShow)||Mo(o)!=="true")&&!t.exitIntentPublishId){const d=Yo(o);this.show(d),this.recreate(o,d)}else this.hide()})}updateViewerIdentifyAttributes(){const t=Number(Po()||0)+1;Tn(t.toString()),Ro()||In(new Date().toISOString())}handleMouseDown(){this.userInteracted=!0,document.removeEventListener("mousedown",this.handleMouseDown)}registerEvents(){document.addEventListener("mousedown",()=>{this.handleMouseDown()}),document.body.addEventListener("mouseleave",()=>h(this,null,function*(){var s;const t=(s=this.bubbleSettings)==null?void 0:s.exitIntentPublishId;if(t&&this.userInteracted){const n=this.widgets.find(i=>{var r;return(r=i==null?void 0:i.bubbleSettings)==null?void 0:r.exitIntentPublishId});n&&(yield this.recreate(t,n.name,{startPlayerImmediately:!0}))}}))}start(t=x){const o=Y(this.widgets,t);o&&o.start()}startPart(t,o=x){const s=Y(this.widgets,o);s&&s.startPart(t)}hide(t=x){const o=Y(this.widgets,t);o&&o.hide()}show(t=x){const o=Y(this.widgets,t);o&&o.show()}on(t,o,s=x){const n=Y(this.widgets,s);n&&n.eventChange(t,o)}recreate(t,o=x,s={}){const n=Y(this.widgets,o);n&&n.recreate(t,s)}}const Y=(e,t)=>e.find(o=>o.name===t);class Go{addHours(t,o=new Date){return o.setTime(o.getTime()+t*60*60*1e3),o}getTolstoyViewers(){const t=Vt();for(const[s,n]of Object.entries(t)){const i=n.restrictionLimits;!i||!(i!=null&&i.time&&new Date(i==null?void 0:i.time)<=new Date)||delete t[s].restrictionLimits}const o=JSON.stringify(t);return Ft(t),o}updateRestrictions(t,o){var r;const s=Vt(),n=(r=s[o])==null?void 0:r.restrictionLimits;if(!n||(n==null?void 0:n.type)!==t)return;const i=n[t];n[t]=i?i+1:1,n.limit&&n.clickLimit===n[t]&&(n.time=this.addHours(n==null?void 0:n.limit)),s[o].restrictionLimits=n,Ft(s)}updateRules(t){const o=(t==null?void 0:t.publishId)||void 0,s=t==null?void 0:t.limit,n=Vt();let i=n[o];const r=i==null?void 0:i.restrictionLimits;i?i.impressionCount+=1:i={impressionCount:1,playCount:0};let c=n.undefined;if(c?c.impressionCount+=1:c={impressionCount:1,playCount:0},s){let l={limit:Number(s.timeLimit),type:s.type,clickLimit:Number(s.clickLimit)};r&&(l=m(m({},r),l)),i.restrictionLimits=l}else r&&(i.restrictionLimits=null);n[o]=i,n.undefined=c,Ft(n)}}class Mt{static isValidUrl(t){return t?t.startsWith("tel:")||t.startsWith("mailto:")?!0:t.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*)/g)!==null:!1}static isAndroid(){return navigator.userAgent.toLowerCase().indexOf("android")>-1}static isInIframe(){try{return window.self!==window.top}catch(t){return!0}}static isIos(){return/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}static getMobileOperatingSystem(){const t=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(t)?"Windows Phone":/android/i.test(t)?"Android":/iPad|iPhone|iPod/.test(t)&&!window.MSStream?"iOS":navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2?"ipad":null}static isMobile(){return Mt.getMobileOperatingSystem()!=null}static isSafari(){return window.safari!==void 0}static enforceProtocol(t,o="https"){return t.startsWith("http")||t.startsWith("//")||t.startsWith("tel:")||t.startsWith("mailto:")?t:`${o}://${t}`}static removeProtocol(t){return t.replace(/(^\w+:|^)\/\//,"")}static stripUrl(t){return Mt.removeProtocol(t).replace(/^www./,"").replace(/\/$/,"")}}const Br="player-version",$r=(e,t,o)=>{if(o)return`${Rs}`;const s=xo(e);if(s){const i=N("td"),r=Ko(e);return i&&r?s.replace("2.0.0","2.0.0-ls"):r?s.replace("2.0.0","2.0.0-l"):i?s.replace("2.0.0","2.0.0-s"):s}let n=`${Ps}`;return t&&(n+="/feed"),e.publishId&&(n+=`/${e.publishId}`),n},Qe=()=>{var e;return!!(window.Shopify&&((e=window.Shopify)!=null&&e.routes))},Ko=e=>e.playerLazy||N("pl"),xr=e=>{var t,o;return(o=(t=e==null?void 0:e.featureSettings)==null?void 0:t[Br])==null?void 0:o.version},Hr=e=>{var t;return(t=e==null?void 0:e.carouselEmbed)!=null&&t.carouselPlayInTileFirst?Cs:""},Wr=()=>{var e,t,o,s;return((e=window._st)==null?void 0:e.cid)||((s=(o=(t=window.ShopifyAnalytics)==null?void 0:t.meta)==null?void 0:o.page)==null?void 0:s.customerId)||""},Vr=()=>new URLSearchParams(window.location.search).get("authToken"),Fr=()=>{var e;return((e=window.tolstoyUserInfo)==null?void 0:e.email)||window.tolstoyUser},Yr=()=>N(he.tolstoyAutoOpen)||window.tolstoyAutoOpen,vd=()=>N(he.tolstoyAutoOpenOnYou)||window.tolstoyAutoOpenOnYou,Ad=()=>N(he.tolstoyStartVideo)||window.tolstoyStartVideo,Gr=()=>{const e=window.tolstoyMoneyFormat;return e?encodeURIComponent(e):""},Kr=({data:e,isFeed:t,isOnYou:o,email:s,isDynamic:n,modalId:i,tolstoyStartVideo:r})=>{var $t,z,Z,xt,_e,ve,Ae,Oe,Pe,Re,Me;const l=[`url=${`${window.location.origin}${window.location.pathname}`.slice(0,1999)}`,`modalId=${i}`];e.publishId&&l.push(`publishId=${e.publishId}`);const d=Vr();d&&l.push(`authToken=${d}`);const y=s||Fr();if(y&&l.push(`email=${encodeURIComponent(y)}`),e.productId&&l.push(`productId=${e.productId}`),o){const $=localStorage.getItem("tolstoy-anonymousId"),Le=(($t=window.Shopify)==null?void 0:$t.shop)||Nt(),Ht=Array.from(document.querySelectorAll("div")||{}).find(X=>X.textContent.trim()==="Size & Fit"),Ne=Array.from(((z=Ht==null?void 0:Ht.nextElementSibling)==null?void 0:z.childNodes)||{}).filter(X=>X.nodeType===Node.TEXT_NODE).map(X=>X.textContent.trim()).join(" ");Le&&l.push(`appUrl=${Le}`),$&&l.push(`tolstoyAnonymousId=${$}`);const Ue=Bt();return Ue&&l.push(`sessionId=${Ue}`),Ne&&l.push(`productFitDetails=${encodeURIComponent(Ne)}`),l}e.currentProductDbId&&l.push(`currentPageDbProductId=${e.currentProductDbId}`);const p=((Z=window.Shopify)==null?void 0:Z.shop)||"",b=!!(Qe()&&p);if(l.push("host",`safari=${!!(window!=null&&window.safari)}`,`dontDownload=${!!e.dontDownload}`,`playerType=${e.playerType}`,`isShopifyStore=${b}`,`shopifyStoreUrl=${p}`,`ai=${kt()}`),Qe()){const $=(_e=(xt=window.Shopify)==null?void 0:xt.routes)==null?void 0:_e.root;$&&l.push(`shopifyRootRoute=${$}`)}if((ve=window.tolstoyUserInfo)!=null&&ve.name&&l.push(`name=${encodeURIComponent(window.tolstoyUserInfo.name)}`),(Ae=window.tolstoyUserInfo)!=null&&Ae.phone&&l.push(`phone=${encodeURIComponent(window.tolstoyUserInfo.phone)}`),window.tolstoyMoneyFormat){const $=Gr();l.push(`tolstoyMoneyFormat=${$}`)}r&&l.push(`tolstoyStartVideo=${r}`),e.testGroup&&l.push(`group=${e.testGroup}`),e.sneakpeek&&l.push("sneakpeek"),e.sneakpeek_hidden&&l.push("sneakpeek_hidden"),e.token&&l.push(`token=${e.token}`),e.gclid&&l.push(`gclid=${e.gclid}`),e.widgetDelay&&l.push("delay"),e.isShoppable===!1&&l.push(`isShoppable=${e.isShoppable}`),e.si&&l.push(`si=${e.si}`);const S=N("td");S&&l.push(`td=${S}`);const _=Ko(e);_&&l.push(`pl=${_}`);const F=xr(e);F&&l.push(`pv=${F}`);const B=Hr(e);B&&l.push(`playerVariant=${B}`),n&&l.push("isDynamic=true");const q=Wr();q&&l.push(`customerId=${q}`);const Et=Ys();Et.size>0&&l.push(Et.toString()),mt()&&l.push("isTapcart=true");const wt=xo(e);return wt&&e.publishId&&l.push(`publishId=${e.publishId}`),wt&&t&&l.push("isFeed=true"),(Oe=window.tolstoySettings)!=null&&Oe.shouldUseCache&&l.push(`shouldUseCache=${(Pe=window.tolstoySettings)==null?void 0:Pe.shouldUseCache}`),(Re=window.tolstoySettings)!=null&&Re.cacheVersion&&l.push(`cacheVersion=${(Me=window.tolstoySettings)==null?void 0:Me.cacheVersion}`),O()||l.push("userConsent=false"),l},Od=({data:e,isFeed:t,isOnYou:o,email:s,isDynamic:n,modalId:i,tolstoyStartVideo:r})=>{const c=$r(e,t,o),l=Kr({data:e,isFeed:t,isOnYou:o,email:s,isDynamic:n,modalId:i,tolstoyStartVideo:r});return`${c}?${l.join("&")}`};class st{constructor(){var t;if(st.instance)return st.instance;st.instance=this,this.appKey=v(),this.shop=((t=window.Shopify)==null?void 0:t.shop)||Nt(),this.accountSettings=null,this.rules=new Go,this.shouldUseCache=null,this.cacheVersion=null,this.hasLiveBubble=null}init(){return h(this,null,function*(){var t,o,s;if(!(!this.appKey&&!this.shop)){if(this.accountSettings)return this.accountSettings;try{this.accountSettings=yield js(),this.rules.updateRules(this.accountSettings),(((t=this.accountSettings)==null?void 0:t.shouldUseCache)||mo())&&(window.tolstoySettings=window.tolstoySettings||{},window.tolstoySettings.shouldUseCache=!0);const i=((o=this.accountSettings)==null?void 0:o.cacheVersion)||W();return i&&(window.tolstoySettings=window.tolstoySettings||{},window.tolstoySettings.cacheVersion=i),this.hasLiveBubble=((s=this.accountSettings)==null?void 0:s.hasLiveBubble)||!!window.tolstoyWidgetId||Yr(),this.accountSettings}catch(n){return yo("Error loading account settings"),null}}})}}const jo=new st;class jr{constructor(){g(this,"getBubbleSettings",()=>h(this,null,function*(){var c;const t=window.location.href,o=((c=window.Shopify)==null?void 0:c.shop)||Nt();if(!this.appKey&&!o)return;const s=fn(),n=this.rules.getTolstoyViewers(),i=o||window.location.host,r={timestamp:Date.now(),url:t,sessionCount:Number(Po()||0),lastSeenAt:new Date().toISOString(),firstSeenAt:Ro(),tolstoySeenCounter:n,isMobile:Mt.isMobile(),domain:i,appUrl:o,appKey:this.appKey};s&&(r.identifyInfoId=s);try{const l=yield Qs(r);return l?(this.rules.updateRules(l),l):null}catch(l){return null}}));g(this,"init",()=>h(this,null,function*(){var r,c,l,d;if(!((r=this.account)!=null&&r.hasLiveBubble))return;const t=yield this.getBubbleSettings();this.subscribeToUrlChange();const o=window.tolstoyWidgetId||(t==null?void 0:t.publishId)||(t==null?void 0:t.exitIntentPublishId);if(!o){(l=(c=this.widget)==null?void 0:c.hide)==null||l.call(c);return}if(!((d=window.tolstoySettings)==null?void 0:d.alwaysShow)&&Mo(o)==="true")return;const n=Yo(o);let i;n===io?i=yield A(()=>import("./9b77a289d/centered-modal.dcd549c6.js"),["9b77a289d/modal.eb93a2a4.css"]):n===no&&(i=yield A(()=>import("./9b77a289d/bubble.c3e7fa48.js"),["9b77a289d/modal.eb93a2a4.css","9b77a289d/bubble.4d99fbce.css"])),yield Fo(),this.widget?(this.widget.recreate(o,n),this.widget.show()):(this.widget=new kr,yield this.widget.init({bubbleSettings:t,widgetId:o,Component:i.default}))}));g(this,"handleUrlChange",()=>{this.unsubscribeFromUrlChange(),this.init()});this.account=jo,this.rules=new Go,this.appKey=v()}subscribeToUrlChange(){u.subscribe({eventName:a.urlChange,callback:this.handleUrlChange})}unsubscribeFromUrlChange(){u.unsubscribe({eventName:a.urlChange,callback:this.handleUrlChange})}}const qr={tvContainer:"tolstoy-video-page"},zr="tolstoy-tv-container",Pd="tolstoy-tv",Rd={};class Zr{constructor(){this.domUpdatesListenerInitialized=!1,this.loaded=!1}init(){return h(this,null,function*(){yield this.loadVideo(),!this.loaded&&this.registerDomUpdatesListenerIfNeeded()})}loadVideo(){return h(this,null,function*(){const t=document.querySelector(`#${zr}`);if(!t)return;const o=(yield A(()=>import("./9b77a289d/tv.cde4f0f1.js"),["9b77a289d/tv.176639ca.css"])).default;new o({tolstoyContainer:t}).init(),this.loaded=!0})}registerDomUpdatesListenerIfNeeded(){if(this.domUpdatesListenerInitialized)return;const t=[qr.tvContainer];Do({classNames:t,callback:()=>this.loadVideo()}),this.domUpdatesListenerInitialized=!0}}const Xr=[a.urlChange],Qr=e=>{switch(e.data.eventName){case a.urlChange:return No();default:return null}},Jr=["(+https://whatis.contentkingapp.com)","Shopify-Observe-Synthetic-Checks","+http://www.google.com/bot.html","https://naver.me/spd","HeadlessChrome","(+http://www.facebook.com/externalhit_uatext.php)","Bytespider","bot"],ta=()=>Jr.some(e=>window.navigator.userAgent.includes(e)),H={addToCart:"tolstoy_add_to_cart",spotlightCarouselQuickShopClick:"tolstoy_spotlight_carousel_quick_shop_click",productCardClick:"tolstoy_product_card_click"},T={addToCartSuccess:"tolstoy_add_to_cart_success",addToCartError:"tolstoy_add_to_cart_error",rejectCookiePolicy:"tolstoy_reject_cookie_policy",tolstoyZIndexChange:"tolstoy_z_index_change",urlLocaleUpdate:"tolstoy_url_locale_update",productUpdate:"tolstoy_product_update"},qo=Object.values(H),ea=new Set([T.addToCartSuccess,T.addToCartError,T.rejectCookiePolicy,T.tolstoyZIndexChange,T.urlLocaleUpdate,T.productUpdate]),oa=({eventName:e,callback:t})=>{if(!qo.includes(e)){console.error(`Event ${e} is not a valid event`);return}if(!t){console.error("Callback must be provided");return}if(typeof t!="function"){console.error("Callback must be a function");return}return!0};class nt extends ko{constructor(){if(nt.instance)return nt.instance;super({shouldIncludeLogs:!0});g(this,"eventHandler",({data:o={}})=>{const{eventName:s}=o;if(this.eventCallbacks[s])for(const n of this.eventCallbacks[s])try{n(o)}catch(i){console.error(i)}});g(this,"subscribe",(o,s,n={})=>{if(oa({eventName:o,callback:s}))try{super.subscribe({eventName:o,callback:s}),u.postMessage({eventName:a.externalEventSubscribed,subscribedEventName:o,payload:n});const i=new CustomEvent("TOLSTOY_WIDGET_V2_SUBSCRIBE",{detail:{eventName:o,payload:n,callback:s}});window.dispatchEvent(i),console.log("Subscribed to event",o)}catch(i){console.error(i)}});g(this,"unsubscribe",(o,s)=>super.unsubscribe({eventName:o,callback:s}));g(this,"initInternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:qo,callback:this.eventHandler})});nt.instance=this}init(){this.initInternalMessagingSubscriptions(),this.initListener(this.eventHandler)}}const At=new nt;Object.freeze(At);const sa=e=>{const{eventName:t}=e;if(!t){console.error("eventName is required");return}if(!ea.has(t)){console.error(`${t} is not a valid eventName`);return}return!0};class na{constructor(){g(this,"postMessage",(t={})=>{sa(t)&&u.postMessage(t)})}closePlayer(){u.postMessage({eventName:a.closePlayer})}changeEmail(t){window.tolstoyUser=t,u.postMessage({eventName:a.userEmailUpdate,email:t})}identify(){return h(this,arguments,function*(t={}){var n;const{email:o,userId:s}=t;if(!o&&!s){console.error("No email or userId");return}try{o&&this.changeEmail(o),s&&(t.userId=s.toString()),t.appKey=v();const i=yield qs(t);wn(i==null?void 0:i.id)}catch(i){console.error("Error occurred while updating identify info:",i),(n=window.tolstoyCaptureError)==null||n.call(window,i,"Error occurred while updating identify info:"),Sn()}})}}const ue=new na;Object.freeze(ue);const ia=[T.urlLocaleUpdate],ra=({data:e})=>{switch(e.eventName){case T.urlLocaleUpdate:const{payload:t}=e;u.postMessage({eventName:a.urlLocaleUpdate,urlLocale:t.urlLocale});break;default:return null}};class it{constructor(){if(it.instance)return it.instance;it.instance=this}initExternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:ia,callback:ra})}init(){this.initExternalMessagingSubscriptions();const t=window.history.pushState,o=window.history.replaceState;let s=window.location.href;const n=()=>{window.location.href!==s&&(s=window.location.href,u.postMessage({eventName:a.urlChange}))};window.history.pushState=function(){t.apply(window.history,arguments),n()},window.history.replaceState=function(){o.apply(window.history,arguments),n()}}}const zo=new it;Object.freeze(zo);const aa=[a.modalOpen];class ca{constructor(){g(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.modalOpen:this.sendIsAfterpayAppInstalledMessage();return;default:return null}})}sendIsAfterpayAppInstalledMessage(){u.postMessage({eventName:a.isAfterpayAppInstalled,value:!!(window!=null&&window.Afterpay)})}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:aa,callback:this.internalMessagingHandler})}init(){this.initInternalMessagingSubscriptions()}}const Zo=new ca;Object.freeze(Zo);const la=()=>{nn(),sn(Ut.rejected),u.postMessage({eventName:a.rejectCookiePolicy})},da=[T.rejectCookiePolicy];class rt{constructor(){g(this,"externalMessagingHandler",t=>{switch(t.data.eventName){case T.rejectCookiePolicy:return la();default:return null}});g(this,"initExternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:da,callback:this.externalMessagingHandler})});if(rt.instance)return rt.instance;rt.instance=this}init(){this.initExternalMessagingSubscriptions()}}const Xo=new rt;Object.freeze(Xo);const ua={itemSoldOut:"itemSoldOut"},Qo={tolstoyAnonymousId:"__tolstoyAnonymousId"},pa=({description:e})=>{switch(e){case ua.itemSoldOut:return a.addToCartSoldOut;default:return a.addToCartError}},ha=({data:e})=>{const{description:t}=e,o=pa({description:t});u.postMessage(w(m({},e),{eventName:o}))},ya=({data:e})=>{const{variantId:t,productId:o,transmissionId:s,quantity:n,productHandle:i,templateSuffix:r}=e;u.postMessage({variantId:t,productId:o,transmissionId:s,quantity:n,productHandle:i,eventName:H.addToCart,templateSuffix:r})},ga=({data:e})=>{const{product:t,transmissionId:o}=e;u.postMessage({product:t,transmissionId:o,eventName:H.spotlightCarouselQuickShopClick})},ma=({data:e})=>{const{subscribedEventName:t,payload:o={}}=e,{disableDefault:s}=o;switch(t){case H.addToCart:case H.spotlightCarouselQuickShopClick:s&&u.postMessage({eventName:a.addToCartDisableDefault});break;default:return null}},Ea=({data:e})=>{u.postMessage(w(m({},e),{eventName:a.addToCartSuccess}))},wa=[a.addToCart,a.spotlightCarouselQuickShopClick,a.externalEventSubscribed],fa=[T.addToCartSuccess,T.addToCartError];class at{constructor(){g(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.addToCart:return ya(t);case a.spotlightCarouselQuickShopClick:return ga(t);case a.externalEventSubscribed:return ma(t);default:return null}});g(this,"externalMessagingHandler",t=>{switch(t.data.eventName){case T.addToCartSuccess:return Ea(t);case T.addToCartError:return ha(t);default:return null}});g(this,"initInternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:wa,callback:this.internalMessagingHandler})});g(this,"initExternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:fa,callback:this.externalMessagingHandler})});if(at.instance)return at.instance;at.instance=this}init(){this.initInternalMessagingSubscriptions(),this.initExternalMessagingSubscriptions()}}const Jo=new at;Object.freeze(Jo);const Sa=[a.externalEventSubscribed,a.productCardClick],Ta=({subscribedEventName:e,payload:t})=>{switch(e){case H.productCardClick:{const{disableProductModal:o=!0}=t;u.postMessage({eventName:a.productCardClickSubscribed,isDisableProductModal:o});break}default:return null}},Ia=({data:e})=>{const{eventName:t}=e;switch(t){case a.externalEventSubscribed:{const{subscribedEventName:o,payload:s}=e;Ta({subscribedEventName:o,payload:s});break}case a.productCardClick:{const{variantId:o,productId:s,externalProductIds:n,productHandle:i}=e;u.postMessage({eventName:H.productCardClick,variantId:o,productId:s,taggedProductIds:n,productHandle:i});break}default:return null}};class ba{initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Sa,callback:Ia})}init(){this.initInternalMessagingSubscriptions()}}const ts=new ba;Object.freeze(ts);const Ca=[a.getProductsMetafields];class _a{constructor(){g(this,"internalMessagingHandler",({data:t})=>{var o;switch(t.eventName){case a.getProductsMetafields:if(!((o=t==null?void 0:t.productIds)!=null&&o.length))return;u.postMessage({productsExtraData:this.getProductsMetafields(t.productIds),modalId:t.modalId,eventName:a.returnProductsMetafields});return;default:return null}})}getProductsMetafields(t=[]){var s,n;const o={};for(const i of t)o[i]=(n=(s=window==null?void 0:window.metafields)==null?void 0:s.products)==null?void 0:n[i];return o}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Ca,callback:this.internalMessagingHandler})}init(){this.initInternalMessagingSubscriptions()}}const es=new _a;Object.freeze(es);const va=[a.openRebuyCart],qt={show:"rebuy:smartcart.show",hide:"rebuy:smartcart.hide",init:"rebuy:smartcart.init"};class Aa{constructor(){g(this,"sendIsRebuyAppInstalledMessage",()=>{var t,o;if(!((t=window==null?void 0:window.Rebuy)!=null&&t.SmartCart)){document.addEventListener(qt.init,this.sendIsRebuyAppInstalledMessage,{once:!0});return}u.postMessage({eventName:a.isRebuyAppInstalled,value:!!((o=window==null?void 0:window.Rebuy)!=null&&o.SmartCart)}),this.initRebuyEventListeners()});g(this,"internalMessagingHandler",t=>{var o,s;switch(t.data.eventName){case a.openRebuyCart:return(s=(o=window==null?void 0:window.Rebuy)==null?void 0:o.SmartCart)==null?void 0:s.show();default:return null}})}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:va,callback:this.internalMessagingHandler})}initRebuyEventListeners(){document.addEventListener(qt.show,()=>{u.postMessage({eventName:a.rebuyCartShown})}),document.addEventListener(qt.hide,()=>{u.postMessage({eventName:a.rebuyCartHidden})})}init(){this.initInternalMessagingSubscriptions(),this.sendIsRebuyAppInstalledMessage()}}const os=new Aa;Object.freeze(os);const Oa=[a.openKendoModal];class Pa{constructor(){g(this,"internalMessagingHandler",t=>{var o,s;switch(t.data.eventName){case a.openKendoModal:u.postMessage({eventName:a.changeZIndex,zIndex:1e3}),(s=(o=window.KENDO)==null?void 0:o.openQuickModalByHandle)==null||s.call(o,t.data.productHandle);const n=t.data.quantity;if(n<=1)return;for(let i=1;i<n;i++)setTimeout(()=>{var c;const r=document.querySelector(".quantity-selector__action--increment");(c=r==null?void 0:r.click)==null||c.call(r)},1e3+i*150);return;default:return null}})}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Oa,callback:this.internalMessagingHandler})}init(){this.initInternalMessagingSubscriptions()}}const ss=new Pa;Object.freeze(ss);const Ra=[a.addToCart,a.playerReady,a.productCardClick],Ma={cartUpdated:"cart/updated"},La=({productId:e,variantId:t})=>{const o={productId:String(e)};return t&&(o.variantId=String(t)),window.Tapcart.actions.openProduct(o)},Na=e=>{const o=setTimeout(()=>{u.postMessage(w(m({},e),{eventName:a.addToCartError}))},4e3);window.Tapcart.registerEventHandler(Ma.cartUpdated,()=>{clearTimeout(o),u.postMessage(w(m({},e),{eventName:a.addToCartSuccess}))})},Ua=e=>h(void 0,null,function*(){const{variantId:t,productId:o}=e;try{Na(e),window.Tapcart.actions.addToCart({lineItems:[{variantId:String(t||o),quantity:1}]})}catch(s){return u.postMessage(w(m({},e),{error:s,eventName:a.addToCartError}))}}),Da=()=>{var e,t,o,s,n,i;try{const r=So();if(!r)return;const l=[...((o=(t=(e=window==null?void 0:window.Tapcart)==null?void 0:e.variables)==null?void 0:t.cart)==null?void 0:o.attributes)||[],{key:Qo.tolstoyAnonymousId,value:r}];(i=(n=(s=window==null?void 0:window.Tapcart)==null?void 0:s.actions)==null?void 0:n.updateCartAttributes)==null||i.call(n,{attributes:l})}catch(r){ce({text:r==null?void 0:r.message,parentUrl:window.location.href,appKey:v(),source:"tapcart",eventName:"widgetError",timestamp:new Date().toISOString()})}};class ka{constructor(){g(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.playerReady:return this.disableCartDefault();case a.productCardClick:return La(t.data);case a.addToCart:return Ua(t.data);default:return null}})}disableCartDefault(){u.postMessage({eventName:a.addToCartDisableDefault})}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Ra,callback:this.internalMessagingHandler})}init(){mt()&&(this.initInternalMessagingSubscriptions(),Da())}}const ns=new ka;Object.freeze(ns);const is={USD:"$",CAD:"CA$",EUR:"",AED:"..",AFN:"",ALL:"Lek",AMD:".",ARS:"$",AUD:"AU$",AZN:".",BAM:"KM",BDT:"",BGN:".",BHD:"..",BIF:"FBu",BND:"$",BOB:"Bs",BRL:"R$",BWP:"P",BYN:".",BZD:"$",CDF:"FrCD",CHF:"CHF",CLP:"$",CNY:"CN",COP:"$",CRC:"",CVE:"CV$",CZK:"K",DJF:"Fdj",DKK:"kr",DOP:"RD$",DZD:"..",EEK:"kr",EGP:"..",ERN:"Nfk",ETB:"Br",GBP:"",GEL:"GEL",GHS:"GH",GNF:"FG",GTQ:"Q",HKD:"$",HNL:"L",HRK:"kn",HUF:"Ft",IDR:"Rp",ILS:"",INR:"",IQD:"..",IRR:"",ISK:"kr",JMD:"$",JOD:"..",JPY:"",KES:"Ksh",KHR:"",KMF:"FC",KRW:"",KWD:"..",KZT:".",LBP:"..",LKR:"SL Re",LTL:"Lt",LVL:"Ls",LYD:"..",MAD:"..",MDL:"MDL",MGA:"MGA",MKD:"MKD",MMK:"K",MOP:"MOP$",MUR:"MURs",MXN:"MX$",MYR:"RM",MZN:"MTn",NAD:"N$",NGN:"",NIO:"C$",NOK:"kr",NPR:"",NZD:"$",OMR:"..",PAB:"B/.",PEN:"S/.",PHP:"",PKR:"",PLN:"z",PYG:"",QAR:"..",RON:"RON",RSD:".",RUB:".",RWF:"FR",SAR:"..",SDG:"SDG",SEK:"kr",SGD:"$",SOS:"Ssh",SYP:"..",THB:"",TND:"..",TOP:"T$",TRY:"TL",TTD:"$",TWD:"NT$",TZS:"TSh",UAH:"",UGX:"USh",UYU:"$",UZS:"UZS",VEF:"Bs.F.",VND:"",XAF:"FCFA",XOF:"CFA",YER:"..",ZAR:"R",ZMK:"ZK",ZWL:"ZWL$"},Ba=()=>{var e,t;return Number((t=(e=window.Shopify)==null?void 0:e.currency)==null?void 0:t.rate)===1},Md=e=>typeof e=="string"&&e.includes("cdn.shopify.com"),Je={soldOut:"already sold out",sellingPlanRequired:"Variant can only be purchased with a selling plan."},$a=[a.addToCartDisableDefault,a.setAnonymousIdToCart,a.loginWithMultipassUrlRequest,a.cartItemQuantityChange,a.cartDataRequest,a.productRecommendationsRequest,a.requestProductsUpdate,a.blockAnonymousIdToCart],to=[a.addToCart,a.spotlightCarouselQuickShopClick],zt=e=>({headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)});let eo=!1,Zt=!1;const Xt={},It={};class ct{constructor(){g(this,"getProduct",t=>h(this,null,function*(){if(Xt[t])return Xt[t];if(It[t])return It[t];const o=this.fetchRawProduct(t);It[t]=o;const s=yield o;return Xt[t]=s,delete It[t],s}));g(this,"onRequestProductsUpdateMessage",o=>h(this,[o],function*({handles:t}){const n=[...new Set(t)].map(r=>this.getProduct(r)),i=(yield Promise.all(n)).filter(Boolean);for(const r of i)u.postMessage({eventName:a.productUpdateResponse,product:r,isProductUpdateResponse:!0})}));g(this,"shopifyAddToCart",r=>h(this,[r],function*({variantId:t,productHandle:o,sellingPlanId:s,quantity:n=As,transmissionId:i}){const c={};Zt||(c._isAddedFromTolstoy=!0);const l={id:t,quantity:n,properties:c};s&&(l.selling_plan=s);const y=zt({items:[l]});try{const p=yield fetch(`${this.storeRootUrl}cart/add.js`,y);if(!p.ok){const b=yield p.json();return this.handleAddToCartError({error:b,variantId:t,productHandle:o,transmissionId:i})}this.triggerExternalCartUpdate(),u.postMessage({eventName:a.addToCartSuccess,variantId:t,transmissionId:i,shouldEndTransmission:!1}),this.getCart({transmissionId:i})}catch(p){console.log(p),this.handleAddToCartError({error:p,variantId:t,productHandle:o,transmissionId:i})}}));g(this,"shopifyUpdateItemQuantity",n=>h(this,[n],function*({variantId:t,quantity:o,transmissionId:s}){const i={updates:{[t]:o}},r=zt(i);try{const c=yield fetch(`${this.storeRootUrl}cart/update.js`,r);if(!c.ok){const l=yield c.json();return this.handleUpdateItemQuantityError({error:l,variantId:t,transmissionId:s})}this.triggerExternalCartUpdate(),u.postMessage({eventName:a.cartItemQuantityChangeSuccess,variantId:t,transmissionId:s,shouldEndTransmission:!1}),this.getCart({transmissionId:s})}catch(c){this.handleUpdateItemQuantityError({error:c,variantId:t,transmissionId:s})}}));g(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.addToCart:return this.shopifyAddToCart(t.data);case a.spotlightCarouselQuickShopClick:return this.shopifyQuickShopClick(t.data);case a.addToCartDisableDefault:return this.disableAddToCart(t.data);case a.blockAnonymousIdToCart:return this.blockAnonymousIdToCart(t.data);case a.setAnonymousIdToCart:return this.setAnonymousIdToCart(t.data);case a.loginWithMultipassUrlRequest:return this.loginWithMultipassUrl(t.data);case a.cartItemQuantityChange:return this.shopifyUpdateItemQuantity(t.data);case a.cartDataRequest:return this.getCart(t.data);case a.productRecommendationsRequest:return this.getProductRecommendations(t.data);case a.requestProductsUpdate:return this.onRequestProductsUpdateMessage(t.data);default:return null}});g(this,"initInternalMessagingSubscriptions",()=>{if(u.subscribeMultipleEvents({eventNames:$a,callback:this.internalMessagingHandler}),eo){Ds("Add to cart disabled");return}u.subscribeMultipleEvents({eventNames:to,callback:this.internalMessagingHandler})});var t,o,s,n;if(ct.instance)return ct.instance;ct.instance=this,this.isShopifyStore=!!((t=window.Shopify)!=null&&t.shop&&((o=window.Shopify)!=null&&o.routes)),this.storeRootUrl=(n=(s=window.Shopify)==null?void 0:s.routes)==null?void 0:n.root}getIsProductSoldOutError(t){return t.includes(Je.soldOut)}getIsSellingPlanError(t){return t.includes(Je.sellingPlanRequired)}formatProduct(t){var n,i,r;if(!t)return null;const o=((i=(n=window.Shopify)==null?void 0:n.currency)==null?void 0:i.active)||((r=window.Shopify)==null?void 0:r.currency),s=window.tolstoyCurrencySymbol||is[o];return w(m({},t),{id:String(t.id),price:t.price/100,compare_at_price:t.compare_at_price?t.compare_at_price/100:t.compare_at_price,currencyCode:o,currencySymbol:s,variants:t.variants.map(c=>w(m({},c),{price:c.price/100,compare_at_price:c.compare_at_price?c.compare_at_price/100:c.compare_at_price}))})}fetchRawProduct(t){return h(this,null,function*(){const o=this.storeRootUrl+`products/${t}.js`;try{const n=yield(yield fetch(o)).json();return this.formatProduct(n)}catch(s){}})}handleSellingPlanError(t,o){return h(this,null,function*(){const s=yield this.getProduct(o);if(!s)return;const{id:n}=s.selling_plan_groups[0].selling_plans[0];return this.shopifyAddToCart({variantId:t,productHandle:o,sellingPlanId:n})})}handleAddToCartError({error:t,variantId:o,productHandle:s,transmissionId:n}){const{description:i}=t;if(this.getIsProductSoldOutError(i)){u.postMessage({eventName:a.addToCartSoldOut,variantId:o,transmissionId:n});return}if(this.getIsSellingPlanError(i))return this.handleSellingPlanError(o,s);u.postMessage({eventName:a.addToCartError,error:i,variantId:o,transmissionId:n})}handleUpdateItemQuantityError({error:t,variantId:o,transmissionId:s}){const{description:n}=t;u.postMessage({eventName:a.cartItemQuantityChangeError,error:n,variantId:o,transmissionId:s})}getCart(o){return h(this,arguments,function*({transmissionId:t}){try{const n=yield(yield fetch(`${this.storeRootUrl}cart.js`,{method:"GET"})).json();u.postMessage({eventName:a.cartDataResponse,cart:n,transmissionId:t})}catch(s){}})}triggerExternalCartUpdate(){var t,o,s,n,i,r,c,l,d,y,p;(i=(n=(s=(o=(t=window.VueMiniCart)==null?void 0:t.$store)==null?void 0:o._actions)==null?void 0:s.initCart)==null?void 0:n[0])==null||i.call(n),(l=(c=(r=window.slate)==null?void 0:r.cart)==null?void 0:c.reloadCart)==null||l.call(c),(d=window.tolstoyCartRefresh)==null||d.call(window),(y=window.monster_refresh)==null||y.call(window),(p=window.updateMiniCart)==null||p.call(window)}disableAddToCart(){eo=!0,u.unsubscribeMultipleEvents({eventNames:to,callback:this.internalMessagingHandler})}postUrlLocaleUpdateIfNeeded(){var t,o,s,n;((o=(t=window.Shopify)==null?void 0:t.routes)==null?void 0:o.root)!=="/"&&u.postMessage({eventName:a.urlLocaleUpdate,urlLocale:(n=(s=window.Shopify)==null?void 0:s.routes)==null?void 0:n.root})}postIsNonBaseCurrencyIfNeeded(){Ba()||u.postMessage({eventName:a.isNonBaseCurrency})}shopifyQuickShopClick({product:t}){const{variants:o,handle:s,quantity:n=1}=t,i=o[0].id;return this.shopifyAddToCart({variantId:i,productHandle:s,quantity:n})}getProductRecommendations(s){return h(this,arguments,function*({productId:t,transmissionId:o}){const n=`${this.storeRootUrl}recommendations/products.json?product_id=${t}`;try{const i=yield fetch(n,{method:"GET"}),{products:r}=yield i.json();u.postMessage({eventName:a.productRecommendationsResponse,productId:t,products:r,transmissionId:o})}catch(i){}})}loginWithMultipassUrl(s){return h(this,arguments,function*({multipassUrl:t,transmissionId:o}){try{const n=yield fetch(t);u.postMessage({eventName:a.loginWithMultipassUrlResponse,statusCode:n.status,transmissionId:o})}catch(n){}})}setAnonymousIdToCart(o){return h(this,arguments,function*({anonymousId:t}){if(An()==="true"||Zt||!O())return;const s={attributes:{[Qo.tolstoyAnonymousId]:t}},n=zt(s);try{yield fetch(`${this.storeRootUrl}cart/update.js`,n),On(!0)}catch(i){console.error(i)}})}blockAnonymousIdToCart(o){return h(this,arguments,function*({appKey:t}){const s=En(t);Bs(s)||(yield this.setAnonymousIdToCart({anonymousId:null})),Zt=!0})}forceClearAnonymousIdFromCart(){var o;if(((o=window.Shopify)==null?void 0:o.shop)!=="mlt-boutique.myshopify.com")return;const t=v();t&&this.blockAnonymousIdToCart({appKey:t})}init(){this.isShopifyStore&&(this.initInternalMessagingSubscriptions(),this.postUrlLocaleUpdateIfNeeded(),this.postIsNonBaseCurrencyIfNeeded(),this.forceClearAnonymousIdFromCart())}}const rs=new ct;Object.freeze(rs);const xa=e=>({id:e.id,price:e.price,compareAtPrice:e.price,currencyCode:e.currency,currencySymbol:is[e.currency],variants:[{price:e.price,compareAtPrice:e.price}]}),Ha=(e="")=>e.replace("_","-"),Wa=[a.openCommerceSettingsUpdate,a.requestProductsUpdate],Qt={},bt={};class Va{constructor(){g(this,"fetchProduct",t=>h(this,null,function*(){const o=`${this.apiBaseUrl}/products/${t}`,s=new URL(o);s.searchParams.append("client_id",this.clientId),s.searchParams.append("locale",this.locale),s.searchParams.append("currency",this.currencyCode),s.searchParams.append("expand","prices");try{const i=yield(yield fetch(s)).json();return xa(i)}catch(n){console.error("Error fetching product price",n)}}));g(this,"getProduct",t=>h(this,null,function*(){if(Qt[t])return Qt[t];if(bt[t])return bt[t];const o=this.fetchProduct(t);bt[t]=o;const s=yield o;return Qt[t]=s,delete bt[t],s}));g(this,"onRequestProductsUpdateMessage",o=>h(this,[o],function*({productIds:t}){const n=[...new Set(t)].map(r=>this.getProduct(r)),i=(yield Promise.all(n)).filter(Boolean);for(const r of i)u.postMessage({eventName:a.productUpdateResponse,product:r,isProductUpdateResponse:!0})}));g(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.openCommerceSettingsUpdate:return this.onOpenCommerceSettingsUpdate(t.data);case a.requestProductsUpdate:return this.onRequestProductsUpdateMessage(t.data);default:return null}});var t,o,s,n;this.isOpenCommerceStore=!!window.CQuotient,this.siteId=(t=window.CQuotient)==null?void 0:t.siteId,this.locale=Ha((o=window.CQuotient)==null?void 0:o.locale),this.apiBaseUrl="",this.clientId="",this.currencyCode=(n=(s=window.pageContext)==null?void 0:s.ecommerce)==null?void 0:n.currencyCode}postUrlLocaleUpdateIfNeeded(t){this.locale!==t&&u.postMessage({eventName:a.urlLocaleUpdate,urlLocale:this.locale})}postIsNonBaseCurrencyIfNeeded(t){this.currencyCode!==t&&u.postMessage({eventName:a.isNonBaseCurrency,currencyCode:this.currencyCode})}onOpenCommerceSettingsUpdate({openCommerceSettings:t}){const{apiVersion:o,clientId:s,baseLocale:n,baseCurrency:i}=t;this.apiBaseUrl=`https://${window.location.host}/s/${this.siteId}/dw/shop/${o}`,this.clientId=s,this.postUrlLocaleUpdateIfNeeded(n),this.postIsNonBaseCurrencyIfNeeded(i)}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Wa,callback:this.internalMessagingHandler})}init(){this.isOpenCommerceStore&&this.initInternalMessagingSubscriptions()}}const Fa=new Va,Ya=[T.productUpdate],Ga=["id","descriptionHtml","description_html","variants","price","compare_at_price","title"],Ka=["id","price","compare_at_price","title"],ja=e=>Ga.includes(e),qa=e=>Array.isArray(e)?e.flatMap((t,o)=>{const n=Object.keys(t).filter(i=>!Ka.includes(i));return n.length===0?[]:`variants[${o}]: { ${n.join(", ")} }`}):["variants (must be an array)"],za=({product:e})=>{const o=Object.keys(e).filter(s=>!ja(s));if(e.variants&&o.push(...qa(e.variants)),o.length>0){console.error(`Fields ${o.join(", ")} are not supported for product update.`);return}u.postMessage({product:e,eventName:a.productUpdateResponse})},Za=({data:e})=>{switch(e.eventName){case T.productUpdate:return za(e);default:return null}};class Xa{initExternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Ya,callback:Za})}init(){this.initExternalMessagingSubscriptions()}}const as=new Xa;Object.freeze(as);const Qa=[T.addToCartSuccess,T.addToCartError];class lt{constructor(){g(this,"postMessageToWidgetV2",t=>{const{data:o}=t||{},{eventName:s,subscribedEventName:n}=o||{};if(!s&&!n)return;const i=new CustomEvent("TOLSTOY_WIDGET_V2_MESSAGE",{detail:w(m({},o),{eventName:n||s})});window.dispatchEvent(i)});g(this,"initExternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:Qa,callback:this.postMessageToWidgetV2})});if(lt.instance)return lt.instance;lt.instance=this}init(){this.initExternalMessagingSubscriptions()}}const cs=new lt;Object.freeze(cs);const Ja=[a.addToCartError,a.addToCartSuccess,a.addToCartSoldOut,a.isRebuyAppInstalled,a.isAfterpayAppInstalled,a.openRebuyCart,a.returnProductsMetafields,a.rejectCookiePolicy,a.productCardClickSubscribed,a.isTapcart,a.urlLocaleUpdate,a.loginWithMultipassUrlResponse,a.cartDataResponse,a.cartItemQuantityChangeSuccess,a.cartItemQuantityChangeError,a.productRecommendationsResponse,a.productUpdateResponse,a.isNonBaseCurrency,a.eventListenersInitialized],Ct={},Jt={},_t={},te=[];class dt{constructor(){g(this,"eventHandler",({data:t={}})=>{const{modalId:o,eventName:s}=t;if(o)switch(s){case a.addToCart:case a.openRebuyCart:case a.openKendoModal:case a.getProductsMetafields:case a.productCardClick:case a.loginWithMultipassUrlRequest:case a.cartItemQuantityChange:case a.cartDataRequest:case a.productRecommendationsRequest:case a.requestProductsUpdate:case a.moveToUrl:case a.showFeedProductModal:case a.reportModalOpen:case a.reportModalClose:case oo:return this.postInternalMessage({modalId:o,data:t});case a.modalMessagingReady:return this.postInternalMessage({modalId:o,data:t}),this.handleModalMessagingReady({modalId:o});case a.toggleFeedCloseButton:return this.postInternalMessage({modalId:o,data:t});default:return null}});g(this,"internalEventHandler",({data:t})=>{this.postMessageToModal(t)});g(this,"initInternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:Ja,callback:this.internalEventHandler})});if(dt.instance)return dt.instance;dt.instance=this}registerIframe({modalId:t,modalIframe:o}){Ct[t]=o}postInternalMessage({modalId:t,data:o}){delete o.modalId;const s=u.postMessage(o);_t[s]=t}handleModalMessagingReady({modalId:t}){Jt[t]=!0;const o=Ct[t];for(const s of te){const{transmissionId:n}=s,i=_t[n];(!i||i===t)&&this.postMessageToIframe({iframe:o,message:s})}}postMessageToIframe({iframe:t,message:o}){var s;(s=t.contentWindow)==null||s.postMessage(o,"*")}postMessageToAllIframes({message:t}){te.push(t);for(const[o,s]of Object.entries(Ct))Jt[o]&&this.postMessageToIframe({iframe:s,message:t})}postMessageToModal(t){const l=t,{transmissionId:o,shouldEndTransmission:s=!0}=l,n=Be(l,["transmissionId","shouldEndTransmission"]),i=_t[o];if(!i)return this.postMessageToAllIframes({message:n});if(!Jt[i]){te.push(t);return}const c=Ct[i];this.postMessageToIframe({iframe:c,message:n}),s&&delete _t[o]}init(){this.initInternalMessagingSubscriptions(),window.addEventListener("message",this.eventHandler)}}const pe=new dt;Object.freeze(pe);class tc{constructor(){this.domUpdatesListenerInitialized=!1,this.loaded=!1}init(){return h(this,null,function*(){})}loadVideo(){return h(this,null,function*(){})}registerDomUpdatesListenerIfNeeded(){}}const ec=50,oc="8b32dacc-8f1d-4cce-b641-9f60e88f9414",sc=()=>{var t,o;const e=(o=(t=document.querySelector("script[data-collection-id]"))==null?void 0:t.dataset)==null?void 0:o.collectionId;return e!=null&&e.includes("{{ collection.id")||!e?null:e},nc=()=>h(void 0,null,function*(){try{const e=v(),t=sc(),o=K("collection-gallery-projects"),s=JSON.parse(o);if(console.log("collectionGalleryProjects",s),t&&e&&(s!=null&&s.length)){const n=yield Xs(e,t);if(Array.isArray(n)&&(n!=null&&n.length)&&n.some(i=>i.project&&i.collectionId))return n}}catch(e){console.log(e)}return[]}),ic=()=>{var t,o;const e=((t=document.currentScript)==null?void 0:t.src)||((o=import.meta)==null?void 0:o.url);if(e!=null&&e.includes("/we/widget.js")){Fe({src:`https://${re}/wes/widget.js`,container:document.head,attributes:{type:"module"}});return}Fe({src:`https://${re}/ws/widget.js`,container:document.head})},rc=()=>!!document.body,ac=()=>{try{return window.self!==window.top}catch(e){return!0}},cc=()=>ac()&&window.location.host==="theordinary.com",ls=()=>h(void 0,null,function*(){var e,t,o,s,n,i;try{if(window.tolstoyWidget||cc())return;if(ta()){console.debug("Bot user");return}if(!rc()){setTimeout(ls,ec);return}if(mt()&&(yield Xn()),N("td")==="true"&&!((o=(t=(e=document.currentScript)==null?void 0:e.src)==null?void 0:t.includes)!=null&&o.call(t,"/ws/widget.js"))&&!((i=(n=(s=import.meta)==null?void 0:s.url)==null?void 0:n.includes)!=null&&i.call(n,"/wes/widget.js"))){ic();return}Un(),yc(),gc(),mc(),Ec(),wc(),fc(),No();const[,r]=yield Promise.all([lc(),nc()]);yield Promise.all([dc(),uc(),hc(),pc(r)]),Qn()}catch(r){console.log("error",r)}}),lc=()=>h(void 0,null,function*(){return jo.init()}),dc=e=>new jr(e).init(),uc=()=>new Zr().init(),pc=e=>new Ur().init(e),hc=()=>new tc().init(),yc=()=>(u.init(),u),gc=()=>(pe.init(),pe),mc=()=>{At.init();const{subscribe:e,unsubscribe:t}=At;return window.tolstoyWidget=w(m({},window.tolstoyWidget),{subscribe:e,unsubscribe:t}),At},Ec=()=>{const{postMessage:e,closePlayer:t,identify:o,changeEmail:s}=ue;return window.tolstoyWidget=w(m({},window.tolstoyWidget),{postMessage:e,closePlayer:t,identify:o,changeEmail:s}),ue},wc=()=>{rs.init(),zo.init(),Jo.init(),os.init(),ss.init(),ns.init(),Zo.init(),Xo.init(),ts.init(),Fa.init(),as.init(),cs.init(),v()===oc&&es.init()},fc=()=>{u.subscribeMultipleEvents({eventNames:Xr,callback:Qr})};ls();export{ws as $,ad as A,fd as B,oe as C,zc as D,Gc as E,vi as F,Gt as G,bc as H,a as I,hd as J,Vo as K,be as L,Bo as M,Ze as N,ks as O,fs as P,kl as Q,u as R,Is as S,jc as T,qc as U,Zc as V,Tr as W,Kc as X,G as Y,il as Z,A as _,Vs as a,Ds as a$,ne as a0,bs as a1,Wo as a2,Ir as a3,Bs as a4,dd as a5,pl as a6,dl as a7,Pr as a8,Al as a9,no as aA,Go as aB,Ge as aC,Pl as aD,Ml as aE,oo as aF,Vt as aG,Ft as aH,nl as aI,Rl as aJ,Ol as aK,Hl as aL,Ul as aM,_l as aN,vl as aO,cd as aP,uo as aQ,Mo as aR,Mt as aS,wr as aT,po as aU,pe as aV,gl as aW,Lo as aX,vn as aY,rd as aZ,Wl as a_,_d as aa,ie as ab,Er as ac,bd as ad,yl as ae,pd as af,ol as ag,Qc as ah,ee as ai,tl as aj,Jc as ak,Kl as al,jl as am,ql as an,f as ao,E as ap,Mi as aq,el as ar,ut as as,ll as at,al as au,ro as av,wd as aw,fl as ax,io as ay,wl as az,Nt as b,$l as b$,Dl as b0,Oo as b1,zr as b2,Pd as b3,Wr as b4,mt as b5,So as b6,Ad as b7,Rd as b8,cl as b9,sl as bA,Fr as bB,Od as bC,Oc as bD,Ac as bE,Ic as bF,Cc as bG,Tc as bH,vc as bI,_c as bJ,El as bK,Bt as bL,Nl as bM,Sl as bN,Ll as bO,Rc as bP,Pc as bQ,Lc as bR,Mc as bS,Nc as bT,$c as bU,Ql as bV,Bl as bW,si as bX,ni as bY,ul as bZ,ii as b_,Ps as ba,Gr as bb,id as bc,Yt as bd,nd as be,Cl as bf,bn as bg,bl as bh,pn as bi,Es as bj,xc as bk,Fc as bl,ms as bm,md as bn,Dc as bo,Uc as bp,et as bq,Ar as br,Cs as bs,Bc as bt,fr as bu,Xl as bv,kc as bw,T as bx,Yr as by,vd as bz,Cd as c,gd as c0,hl as c1,sd as c2,od as c3,Vc as c4,Yl as c5,Md as c6,xl as c7,Gl as c8,Wc as c9,Qn as ca,ed as cb,Jl as cc,td as cd,ml as ce,Qe as cf,Pt as cg,M as ch,rl as ci,ud as cj,ld as ck,Id as d,Hc as e,_r as f,Ed as g,v as h,Fl as i,Uo as j,yd as k,yo as l,Vl as m,Sd as n,Sr as o,J as p,Ho as q,Ss as r,Yc as s,Td as t,Or as u,Xc as v,se as w,zl as x,Zl as y,N as z};
