var f=Object.defineProperty,w=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var I=(n,t,e)=>t in n?f(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,g=(n,t)=>{for(var e in t||(t={}))D.call(t,e)&&I(n,e,t[e]);if(C)for(var e of C(t))P.call(t,e)&&I(n,e,t[e]);return n},L=(n,t)=>w(n,A(t));var E=(n,t,e)=>I(n,typeof t!="symbol"?t+"":t,e);var c=(n,t,e)=>new Promise((s,a)=>{var o=i=>{try{r(e.next(i))}catch(T){a(T)}},S=i=>{try{r(e.throw(i))}catch(T){a(T)}},r=i=>i.done?s(i.value):Promise.resolve(i.value).then(o,S);r((e=e.apply(n,t)).next())});import{i as y,g as R,a as m,l as O,_ as u,b as U}from"./890f0335e/preload-helper.HSQL4REb.js";import{s as b,g as p}from"./890f0335e/script.utils.D2w9PLfq.js";const l={SUBSCRIBE:"TOLSTOY_WIDGET_V2_SUBSCRIBE",MESSAGE:"TOLSTOY_WIDGET_V2_MESSAGE"},d={ADD_TO_CART:"tolstoy_add_to_cart",SPOTLIGHT_QUICK_SHOP:"tolstoy_spotlight_carousel_quick_shop_click",PRODUCT_CARD_CLICK:"tolstoy_product_card_click"},_=class _{constructor(){E(this,"subscribers");E(this,"eventsStatus");E(this,"handleMessage",t=>{const{detail:e}=t;if(e!=null&&e.eventName)switch(e.eventName){case d.ADD_TO_CART:case d.SPOTLIGHT_QUICK_SHOP:case d.PRODUCT_CARD_CLICK:this.subscribe(e.eventName,e.callback);break;default:this.notifySubscribers(e.eventName,e)}});this.subscribers=new Map,this.eventsStatus={[d.ADD_TO_CART]:!1,[d.SPOTLIGHT_QUICK_SHOP]:!1,[d.PRODUCT_CARD_CLICK]:!1}}static getInstance(){return _.instance||(_.instance=new _),_.instance}formatMessage(t){return L(g({},t),{transmissionId:t.transmissionId||"widget-v2",timestamp:Date.now()})}updateEventStatus(t,e){t in this.eventsStatus&&(this.eventsStatus[t]=e)}isEventSubscribed(t){return this.eventsStatus[t]||!1}notifySubscribers(t,e){const s=this.subscribers.get(t);s==null||s.forEach(a=>{try{a(e)}catch(o){console.error(`Error in ${t} callback:`,o)}})}subscribe(t,e){var s;this.subscribers.has(t)||this.subscribers.set(t,new Set),(s=this.subscribers.get(t))==null||s.add(e),this.updateEventStatus(t,!0)}unsubscribe(t,e){const s=this.subscribers.get(t);s==null||s.delete(e),(s==null?void 0:s.size)===0&&this.updateEventStatus(t,!1)}postMessage(t){const e=this.formatMessage(t),s=new CustomEvent(l.MESSAGE,{detail:e});window.dispatchEvent(s)}init(){window.addEventListener(l.SUBSCRIBE,this.handleMessage),window.addEventListener(l.MESSAGE,this.handleMessage);const t=new CustomEvent(l.SUBSCRIBE);window.addEventListener("tolstoyWidgetReady",()=>{window.dispatchEvent(t)},{once:!0})}destroy(){window.removeEventListener(l.SUBSCRIBE,this.handleMessage),window.removeEventListener(l.MESSAGE,this.handleMessage)}};E(_,"instance");let h=_;const v=()=>{h.getInstance().init()},G={PRODUCT_TILE:"tolstoy-product-tile"},$="./styles/product-tile.css",Q="w-full",M="tolstoy-collection-page-tile",j="./styles/collection-page-tile.css",x={display:"flex",width:"100%",height:"100%",position:"relative"},B=(n,t)=>c(void 0,null,function*(){const s=b()&&y()?R():m(),a=new URLSearchParams;a.set("productId",n),a.set("appKey",t);try{return(yield fetch(`${s}/settings/widget/get-product-gallery-config?${a}`)).json()}catch(o){return O(o,"Error getting collection page tile config"),null}}),V=()=>c(void 0,null,function*(){var S;const n=p("product-id"),t=p("app-key"),e=!!new URLSearchParams(location.search).get("new-render");if(!n||!t)return;const s=yield B(n,t);if(!s)return;const a=s.product.images.map(r=>r.src);if(s.vodAssets.length===0||!((S=s.projects)!=null&&S.length))return;const o=new URLSearchParams(location.search).get("test-gallery");if(o){const{renderTestGalleryIfNeeded:r}=yield u(()=>c(void 0,null,function*(){const{renderTestGalleryIfNeeded:i}=yield import("./890f0335e/render-test-gallery.BPK5TMQU.js");return{renderTestGalleryIfNeeded:i}}),[]);r(o,a)}if(e){const{initImageDetectionV2:r}=yield u(()=>c(void 0,null,function*(){const{initImageDetectionV2:i}=yield import("./890f0335e/image-detection-new.utils.DJteEoNI.js");return{initImageDetectionV2:i}}),[]);return r(s)}else{const{initImageDetection:r}=yield u(()=>c(void 0,null,function*(){const{initImageDetection:i}=yield import("./890f0335e/image-detection.utils.BSy6WJG3.js");return{initImageDetection:i}}),[]);return r(s)}}),N={PRODUCT_TILE:{key:G.PRODUCT_TILE,controller:()=>u(()=>import("./890f0335e/product-tiles-controller.BJpLyC55.js"),[])},COLLECTION_PAGE_TILE:{key:M,controller:()=>u(()=>import("./890f0335e/collection-page-tile-controller.DXbIdLTd.js"),[])}},k={PRODUCT_GALLERY_VIDEO:{init:V}},H=()=>c(void 0,null,function*(){try{v(),yield U(N,k)}catch(n){O(n)}});H();export{j as C,h as E,$ as P,Q as a,x as b};
